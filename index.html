
<!doctype html>
<html lang="no" data-theme="auto">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title id="t_app">TS-kalkulator</title>
  <link rel="manifest" href="manifest.webmanifest">
  <meta name="theme-color" content="#00FFFF" id="themeColor">
  <link rel="icon" href="icon.svg" type="image/svg+xml">
  <script>(function(){try{var s=localStorage.getItem('ts_theme')||'auto';document.documentElement.setAttribute('data-theme',s);var tc=document.getElementById('themeColor');var d=s==='dark'||(s==='auto'&&window.matchMedia&&window.matchMedia('(prefers-color-scheme: dark)').matches);if(tc)tc.setAttribute('content',d?'#0b1220':'#00FFFF');}catch(e){}})();</script>
  <style>
    :root{--bg:#f8fafc;--card:#fff;--muted:#475569;--text:#0f172a;--ring:#e2e8f0;--brand:#00FFFF;--brandText:#041b1b;}
    @media (prefers-color-scheme:dark){
      :root{--bg:#0b1220;--card:#0f172a;--muted:#9aa8bf;--text:#ebf0f7;--ring:#1f2937;--brand:#00FFFF;--brandText:#002c2c;}
    }
    [data-theme="dark"]{--bg:#0b1220;--card:#0f172a;--muted:#9aa8bf;--text:#ebf0f7;--ring:#1f2937;--brand:#00FFFF;--brandText:#002c2c;}
    [data-theme="light"]{--bg:#f8fafc;--card:#fff;--muted:#475569;--text:#0f172a;--ring:#e2e8f0;--brand:#00FFFF;--brandText:#041b1b;}
    *{box-sizing:border-box}body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,'Noto Sans',sans-serif}
    .wrap{max-width:820px;margin:0 auto;padding:14px 18px}
    .pill{display:inline-block;background:var(--brand);color:var(--brandText);padding:12px 22px;border-radius:16px;font-weight:800;border:1px solid #9efefe;box-shadow:0 1px 0 rgba(0,0,0,.06);font-size:28px}
    .subtitle{color:var(--muted);font-size:16px;margin:10px 0 10px}
    .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    .btn{display:inline-block;background:var(--brand);color:var(--brandText);text-decoration:none;padding:10px 14px;border-radius:12px;border:1px solid #9efefe;cursor:pointer}
    .ghost{background:transparent;border:1px solid var(--ring);color:var(--text)}
    .card{background:var(--card);border:1px solid var(--ring);border-radius:16px;padding:16px;box-shadow:0 2px 10px rgba(0,0,0,.04);margin-top:12px}
    label{display:block;font-size:13px;font-weight:700;margin-bottom:6px}
    input{width:100%;padding:12px 14px;border-radius:12px;border:1px solid var(--ring);font-size:20px;background:var(--card);color:var(--text)}
    input[type=range]{padding:0}
    .muted{color:var(--muted)}
    .big{font-size:48px;font-weight:900;letter-spacing:.5px}
    .footer{margin-top:18px;font-size:12px;display:flex;flex-wrap:wrap;gap:8px;align-items:center;justify-content:space-between;border-top:1px solid var(--ring);padding-top:8px}
    .small{font-size:11px;color:var(--muted);margin-top:6px;line-height:1.35}
    .svgbox{background:var(--bg);border:1px solid var(--ring);border-radius:12px;padding:8px;overflow:auto;margin-top:8px}
    .warn{color:#b91c1c}
    details.help>summary{cursor:pointer;font-weight:700}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="pill">TSâ€‘kalkulator</div>
    <div class="row" style="justify-content:space-between;align-items:flex-start">
      <div class="subtitle" id="h_sub">Avlest vinkel pÃ¥ tommestokk omregnet til grader</div>
      <div class="row" style="margin:6px 0 4px">
        <button class="btn" id="qrBtn">QR</button>
        <button class="btn" id="installBtn">Installer</button>
        <button class="btn ghost" id="themeBtn">ðŸŒ“</button>
        <button class="btn ghost" id="decBtn">0 des</button>
        <select id="lang" class="btn ghost" style="min-width:96px">
          <option value="no">NO</option><option value="en">EN</option><option value="sv">SV</option>
          <option value="dk">DK</option><option value="fi">FI</option><option value="de">DE</option>
        </select>
        <button class="btn ghost" id="hardRefreshBtn">Hard refresh</button>
      </div>
    </div>

    <section class="card">
      <label id="lbl_D">Avlest D (mm)</label>
      <input id="D" inputmode="decimal" value="760">
      <input id="sliderD" type="range" min="400" max="800" value="760" style="margin-top:12px">
      <div class="muted" id="rangeText" style="margin-top:6px">mÃ¥leomrÃ¥de 400-800mm</div>
      <div class="muted" style="margin-top:12px" id="lbl_angle">Vinkel (grader)</div>
      <div class="big" id="thetaTop">â€“</div>
    </section>

    <section class="card">
      <div class="subtitle" style="font-weight:800" id="guide_title">Bruksanvisning (kort)</div>
      <ul id="guide_list" class="muted"></ul>
      <details class="help" style="margin-top:8px">
        <summary id="help_btn">Vis forklaring og illustrasjon</summary>
        <div id="help_text" class="muted" style="margin:8px 0 6px"></div>
        <div class="svgbox">
          <!-- Technical SVG (horizontal base, 200 mm section points UP) -->
          <svg id="svgTech" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 940 360" width="100%">
            <defs>
              <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
                <feDropShadow dx="0" dy="2" stdDeviation="2" flood-opacity="0.25"/>
              </filter>
              <marker id="arrow" viewBox="0 0 10 10" refX="9" refY="5" markerWidth="8" markerHeight="8" orient="auto-start-reverse">
                <path d="M0 0L10 5L0 10Z" fill="#444"/>
              </marker>
            </defs>
            <!-- Base ruler -->
            <g transform="translate(60,200)">
              <rect x="0" y="-10" width="820" height="20" rx="4" fill="#e6e6e6" stroke="#888" filter="url(#shadow)"/>
              <g fill="#666">
                <g>
                  <rect x="0" y="-10" width="2" height="10"/><text x="0" y="18" font-size="12" text-anchor="middle">0</text>
                  <rect x="100" y="-10" width="2" height="10"/><text x="100" y="18" font-size="12" text-anchor="middle">100</text>
                  <rect x="200" y="-10" width="2" height="10"/><text x="200" y="18" font-size="12" text-anchor="middle">200</text>
                  <rect x="300" y="-10" width="2" height="10"/><text x="300" y="18" font-size="12" text-anchor="middle">300</text>
                  <rect x="400" y="-10" width="2" height="10"/><text x="400" y="18" font-size="12" text-anchor="middle">400</text>
                  <rect x="500" y="-10" width="2" height="10"/><text x="500" y="18" font-size="12" text-anchor="middle">500</text>
                  <rect x="600" y="-10" width="2" height="10"/><text x="600" y="18" font-size="12" text-anchor="middle">600</text>
                  <rect x="700" y="-10" width="2" height="10"/><text x="700" y="18" font-size="12" text-anchor="middle">700</text>
                  <rect x="800" y="-10" width="2" height="10"/><text x="800" y="18" font-size="12" text-anchor="middle">800</text>
                </g>
                <g opacity="0.9"><rect x="50" y="-10" width="1.6" height="8"/><rect x="150" y="-10" width="1.6" height="8"/><rect x="250" y="-10" width="1.6" height="8"/><rect x="350" y="-10" width="1.6" height="8"/><rect x="450" y="-10" width="1.6" height="8"/><rect x="550" y="-10" width="1.6" height="8"/><rect x="650" y="-10" width="1.6" height="8"/><rect x="750" y="-10" width="1.6" height="8"/></g>
                <g opacity="0.6"><rect x="10" y="-10" width="1.2" height="6"/><rect x="20" y="-10" width="1.2" height="6"/><rect x="30" y="-10" width="1.2" height="6"/><rect x="40" y="-10" width="1.2" height="6"/><rect x="60" y="-10" width="1.2" height="6"/><rect x="70" y="-10" width="1.2" height="6"/><rect x="80" y="-10" width="1.2" height="6"/><rect x="90" y="-10" width="1.2" height="6"/><rect x="110" y="-10" width="1.2" height="6"/><rect x="120" y="-10" width="1.2" height="6"/><rect x="130" y="-10" width="1.2" height="6"/><rect x="140" y="-10" width="1.2" height="6"/><rect x="160" y="-10" width="1.2" height="6"/><rect x="170" y="-10" width="1.2" height="6"/><rect x="180" y="-10" width="1.2" height="6"/><rect x="190" y="-10" width="1.2" height="6"/><rect x="210" y="-10" width="1.2" height="6"/><rect x="220" y="-10" width="1.2" height="6"/><rect x="230" y="-10" width="1.2" height="6"/><rect x="240" y="-10" width="1.2" height="6"/><rect x="260" y="-10" width="1.2" height="6"/><rect x="270" y="-10" width="1.2" height="6"/><rect x="280" y="-10" width="1.2" height="6"/><rect x="290" y="-10" width="1.2" height="6"/><rect x="310" y="-10" width="1.2" height="6"/><rect x="320" y="-10" width="1.2" height="6"/><rect x="330" y="-10" width="1.2" height="6"/><rect x="340" y="-10" width="1.2" height="6"/><rect x="360" y="-10" width="1.2" height="6"/><rect x="370" y="-10" width="1.2" height="6"/><rect x="380" y="-10" width="1.2" height="6"/><rect x="390" y="-10" width="1.2" height="6"/><rect x="410" y="-10" width="1.2" height="6"/><rect x="420" y="-10" width="1.2" height="6"/><rect x="430" y="-10" width="1.2" height="6"/><rect x="440" y="-10" width="1.2" height="6"/><rect x="460" y="-10" width="1.2" height="6"/><rect x="470" y="-10" width="1.2" height="6"/><rect x="480" y="-10" width="1.2" height="6"/><rect x="490" y="-10" width="1.2" height="6"/><rect x="510" y="-10" width="1.2" height="6"/><rect x="520" y="-10" width="1.2" height="6"/><rect x="530" y="-10" width="1.2" height="6"/><rect x="540" y="-10" width="1.2" height="6"/><rect x="560" y="-10" width="1.2" height="6"/><rect x="570" y="-10" width="1.2" height="6"/><rect x="580" y="-10" width="1.2" height="6"/><rect x="590" y="-10" width="1.2" height="6"/><rect x="610" y="-10" width="1.2" height="6"/><rect x="620" y="-10" width="1.2" height="6"/><rect x="630" y="-10" width="1.2" height="6"/><rect x="640" y="-10" width="1.2" height="6"/><rect x="660" y="-10" width="1.2" height="6"/><rect x="670" y="-10" width="1.2" height="6"/><rect x="680" y="-10" width="1.2" height="6"/><rect x="690" y="-10" width="1.2" height="6"/><rect x="710" y="-10" width="1.2" height="6"/><rect x="720" y="-10" width="1.2" height="6"/><rect x="730" y="-10" width="1.2" height="6"/><rect x="740" y="-10" width="1.2" height="6"/><rect x="760" y="-10" width="1.2" height="6"/><rect x="770" y="-10" width="1.2" height="6"/><rect x="780" y="-10" width="1.2" height="6"/><rect x="790" y="-10" width="1.2" height="6"/></g>
              </g>
              <!-- Read edge -->
              <rect x="-2" y="-12" width="6" height="24" fill="#00FFFF" stroke="#088"/>
              <line x1="0" y1="-10" x2="0" y2="120" stroke="#444" stroke-dasharray="4 3"/>
              <text x="10" y="116" font-size="12">Kant for avlesning</text>
            </g>

            <!-- 200 mm section (points UP now) -->
            <g transform="translate(260,200) rotate(-65)">
              <rect x="0" y="-10" width="200" height="20" rx="4" fill="#ffe9cc" stroke="#c88" filter="url(#shadow)"/>
              <circle cx="0" cy="0" r="8" fill="#fff" stroke="#c88"/>
              <circle cx="0" cy="0" r="3" fill="#c88"/>
              <text x="100" y="-14" font-size="12" text-anchor="middle">200 mmâ€‘ledd (Î¸)</text>
            </g>
            <path d="M260,200 A70,70 0 0,1 305,160" fill="none" stroke="#c44" stroke-width="2"/>
            <text x="305" y="164" font-size="12" fill="#c44">Î¸</text>

            <!-- 400 mm feeler -->
            <g transform="translate(460,200) rotate(-25)">
              <rect x="0" y="-9" width="400" height="18" rx="4" fill="#dfe9ff" stroke="#88a" filter="url(#shadow)"/>
              <circle cx="0" cy="0" r="8" fill="#fff" stroke="#88a"/>
              <circle cx="0" cy="0" r="3" fill="#88a"/>
              <text x="200" y="-14" font-size="12" text-anchor="middle">400 mmâ€‘ledd (fÃ¸lerarm)</text>
            </g>

            <!-- Dimension D -->
            <g>
              <line x1="60" y1="250" x2="740" y2="250" stroke="#444" marker-start="url(#arrow)" marker-end="url(#arrow)"/>
              <line x1="60" y1="240" x2="60" y2="260" stroke="#444"/>
              <line x1="740" y1="240" x2="740" y2="260" stroke="#444"/>
              <text x="400" y="268" font-size="13" text-anchor="middle">Avlest D (mm) langs kanten</text>
            </g>

            <!-- Landmark notes -->
            <g transform="translate(60,200)">
              <line x1="678" y1="-10" x2="678" y2="30" stroke="#2c7" stroke-dasharray="4 3"/>
              <text x="678" y="44" font-size="12" text-anchor="middle">â‰ˆ678 mm â‰ˆ 90Â°</text>
              <text x="400" y="44" font-size="12" text-anchor="middle">400 mm â‰ˆ 0Â°</text>
              <text x="800" y="44" font-size="12" text-anchor="middle">800 mm â‰ˆ 180Â°</text>
            </g>
          </svg>
        </div>
      </details>
    </section>

    <div class="footer muted">
      <div>Â© Stymparen</div><div id="ver">3.9.7a</div>
    </div>
    <div class="small">
      HultaforsÂ® er et registrert varemerke tilhÃ¸rende Hultafors Group. Denne kalkulatoren er uavhengig og ikke tilknyttet, godkjent av eller sponset av Hultafors. â€”
      HultaforsÂ® is a registered trademark of Hultafors Group. This calculator is independent and not affiliated with, endorsed or sponsored by Hultafors.
    </div>
  </div>

  <!-- QR modal -->
  <div id="qrModal" style="display:none;align-items:center;justify-content:center;position:fixed;inset:0;background:rgba(0,0,0,.55);z-index:9999">
    <div class="card" style="max-width:92vw">
      <div class="row" style="justify-content:space-between"><h3 style="margin:0">QR-kode</h3><button class="btn ghost" id="qrClose">Lukk</button></div>
      <div class="muted" style="border:1px solid var(--ring);border-radius:10px;padding:8px 10px;margin-top:6px" id="qrUrlBox">https://wernerjakobsen-max.github.io/TS-Kalkulator/?v=3.9.7a</div>
      <img id="qrImg" alt="QR-kode" style="display:block;margin:12px auto;border:1px solid var(--ring);max-width:72vw;height:auto">
      <div class="row"><button class="btn" id="copyUrl">Kopier lenke</button><a id="qrDownload" class="btn" download="ts-kalkulator-qr.png">Last ned PNG</a></div>
    </div>
  </div>

  <!-- Install modal -->
  <div id="instModal" style="display:none;align-items:center;justify-content:center;position:fixed;inset:0;background:rgba(0,0,0,.55);z-index:9999">
    <div class="card" style="max-width:92vw">
      <div class="row" style="justify-content:space-between"><h3 style="margin:0">Installer app</h3><button class="btn ghost" id="instClose">Lukk</button></div>
      <div class="muted" style="margin-top:8px">
        Hvis install-knappen ikke dukker opp: <br>
        <b>Android/Chrome:</b> meny â‹® â†’ Â«Legg til pÃ¥ startsidenÂ».<br>
        <b>iOS (Safari):</b> delingsikonet âŽ‹ â†’ Â«FÃ¸y til Hjem-skjermÂ».<br>
        <b>Desktop:</b> adresselinje Â«Installer appÂ»-ikon eller meny.
      </div>
    </div>
  </div>

<script>
  const $ = (id) => document.getElementById(id);
  const CANONICAL="https://wernerjakobsen-max.github.io/TS-Kalkulator/?v=3.9.7a";

  const X=[400,420,430,500,525,533,536,590,594,623,678,718,743,756,767,779,785,791,796,800];
  const Y=[0,8,10.5,31,38,41,42,59,60,70,90,107,120,128,135,145,150,157,166,180];

  const STR={
    no:{app:"TS-kalkulator",sub:"Avlest vinkel pÃ¥ tommestokk omregnet til grader",lblD:"Avlest D (mm)",range:"mÃ¥leomrÃ¥de 400-800mm",angle:"Vinkel (grader)",guide_title:"Bruksanvisning (kort)",guide:["Utstyr: plast tommestokk 2 m (f.eks. Hultafors), leddbredde ca. 15 mm.","Knekk 200 mmâ€‘leddet til Ã¸nsket vinkel.","Knekk 400 mmâ€‘leddet og bÃ¸y til 0â€‘mmâ€‘hjÃ¸rnet treffer kanten.","Les av mm langs kanten. Skriv inn her â€“ du fÃ¥r graden.","Gyldig omrÃ¥de: 400â€“800 mm (400â‰ˆ0Â°, 800â‰ˆ180Â°)."],help_btn:"Vis forklaring og illustrasjon",help_text:"Prinsipp: 200â€‘ledd i vinkel Î¸. 400â€‘ledd som fÃ¸ler til 0â€‘hjÃ¸rnet treffer kanten. Avlest D â†’ vinkel via kalibrert kurve."},
    en:{app:"TS Calculator",sub:"Angle from folding ruler reading (mm â†’ degrees)",lblD:"Reading D (mm)",range:"measuring range 400â€“800 mm",angle:"Angle (degrees)",guide_title:"Quick instructions",guide:["Tool: 2 m plastic folding ruler (e.g., Hultafors), joint width â‰ˆ 15 mm.","Bend 200â€‘mm section to desired angle.","Bend 400â€‘mm section until the 0â€‘mm corner meets the edge.","Read D in mm along the edge and enter it here.","Valid range: 400â€“800 mm (400â‰ˆ0Â°, 800â‰ˆ180Â°)."],help_btn:"Show explanation and illustration",help_text:"Principle: 200â€‘mm at angle Î¸. 400â€‘mm as feeler to the 0â€‘corner. Edge reading D â†’ angle via calibrated curve."}
  };

  function pchipSlopes(x,y){
    const n=x.length,h=new Array(n-1),d=new Array(n-1);
    for(let i=0;i<n-1;i++){h[i]=x[i+1]-x[i];d[i]=(y[i+1]-y[i])/h[i];}
    const m=new Array(n); m[0]=d[0]; m[n-1]=d[n-2];
    for(let i=1;i<n-1;i++){
      if(d[i-1]*d[i]<=0) m[i]=0;
      else {const w1=2*h[i]+h[i-1],w2=h[i]+2*h[i-1]; m[i]=(w1+w2)/(w1/d[i-1]+w2/d[i]);}
    }
    for(let i=0;i<n-1;i++){
      if(d[i]===0){m[i]=0; m[i+1]=0;}
      else {const a=m[i]/d[i],b=m[i+1]/d[i],s=a*a+b*b; if(s>9){const t=3/Math.sqrt(s); m[i]=t*a*d[i]; m[i+1]=t*b*d[i];}}
    }
    return m;
  }
  const M=pchipSlopes(X,Y);
  function pchipEval(xq){
    const n=X.length; if(xq<X[0]||xq>X[n-1])return null;
    let i=0,j=n-1; while(j-i>1){const k=(i+j)>>1; if(X[k]<=xq)i=k; else j=k;}
    const h=X[i+1]-X[i],t=(xq-X[i])/h;
    const h00=(1+2*t)*(1-t)*(1-t),h10=t*(1-t)*(1-t),h01=t*t*(3-2*t),h11=t*t*(t-1);
    return h00*Y[i]+h10*h*M[i]+h01*Y[i+1]+h11*h*M[i+1];
  }

  const LANG_KEY='ts_lang', DEC_KEY='ts_dec';
  const themeEl=document.documentElement,themeKey='ts_theme',themeColorTag=document.getElementById('themeColor');
  function applyTheme(v){themeEl.setAttribute('data-theme',v); try{localStorage.setItem(themeKey,v);}catch(e){} if(themeColorTag)themeColorTag.setAttribute('content',(v==='dark')?'#0b1220':'#00FFFF');}
  function toggleTheme(){const cur=themeEl.getAttribute('data-theme')||'auto';applyTheme(cur==='dark'?'light':cur==='light'?'auto':'dark');}
  function setLang(c){try{localStorage.setItem(LANG_KEY,c);}catch(e){} applyLang(c);}
  function getLang(){try{return localStorage.getItem(LANG_KEY)||'no';}catch(e){return'no';}}
  function getDec(){try{return parseInt(localStorage.getItem(DEC_KEY)||'0',10);}catch(e){return 0;}}
  function setDec(n){try{localStorage.setItem(DEC_KEY,String(n));}catch(e){} updateDecBtn(); render();}
  function toggleDec(){setDec(getDec()===0?1:0);}
  function updateDecBtn(){ $('decBtn').textContent=(getDec()===0?'0 des':'1 des'); }
  function Fdeg(v){const d=getDec(); return (d===0?Math.round(v):v.toFixed(d))+'Â°';}

  function applyLang(c){
    const S=(STR[c]||STR.no);
    document.title = "TS-kalkulator";
    $('h_sub').textContent=S.sub;
    $('lbl_D').textContent=S.lblD; $('rangeText').textContent=S.range; $('lbl_angle').textContent=S.angle;
    $('guide_title').textContent=S.guide_title;
    const ul=$('guide_list'); ul.innerHTML=''; S.guide.forEach(t=>{const li=document.createElement('li'); li.textContent=t; ul.appendChild(li);});
    $('help_btn').textContent=S.help_btn; $('help_text').textContent=S.help_text;
  }

  function render(){
    const D=parseFloat(String($('D').value).replace(',','.'));
    if(!Number.isFinite(D)){ $('thetaTop').textContent='â€“'; return; }
    $('sliderD').value=String(Math.max(400,Math.min(800,D)));
    const deg=pchipEval(D);
    if(deg==null){ $('rangeText').classList.add('warn'); $('thetaTop').textContent='â€“'; }
    else { $('rangeText').classList.remove('warn'); $('thetaTop').textContent=Fdeg(deg); }
  }

  function openQR(){
    const url=CANONICAL, enc=encodeURIComponent(url);
    $('qrUrlBox').textContent=url;
    $('qrImg').src=`https://api.qrserver.com/v1/create-qr-code/?size=512x512&margin=10&data=${enc}`;
    $('qrDownload').href=$('qrImg').src;
    $('qrModal').style.display='flex';
  }
  function closeQR(){ $('qrModal').style.display='none'; }
  function copyUrl(){ navigator.clipboard.writeText(CANONICAL).then(()=>{$('copyUrl').textContent='Kopiert!'; setTimeout(()=>{$('copyUrl').textContent='Kopier lenke';},1200);}).catch(()=>{}); }

  let deferredPrompt=null;
  window.addEventListener('beforeinstallprompt', (e)=>{ e.preventDefault(); deferredPrompt=e; });
  async function tryInstall(){
    if(deferredPrompt){ await deferredPrompt.prompt(); deferredPrompt=null; return; }
    document.getElementById('instModal').style.display='flex';
  }

  document.addEventListener('DOMContentLoaded', ()=>{
    $('lang').value=getLang(); applyLang(getLang());
    $('lang').addEventListener('change',(e)=>setLang(e.target.value));
    updateDecBtn();
    $('decBtn').addEventListener('click',toggleDec);
    $('themeBtn').addEventListener('click',toggleTheme);
    $('D').addEventListener('input',render);
    $('sliderD').addEventListener('input',e=>{ $('D').value=e.target.value; render(); });
    $('qrBtn').addEventListener('click',openQR);
    $('qrClose').addEventListener('click',closeQR);
    $('copyUrl').addEventListener('click',copyUrl);
    $('installBtn').addEventListener('click',tryInstall);
    $('instClose').addEventListener('click',()=>{ document.getElementById('instModal').style.display='none'; });
    $('hardRefreshBtn').addEventListener('click', async ()=>{
      if('caches' in window){ const names=await caches.keys(); await Promise.all(names.map(n=>caches.delete(n))); }
      if('serviceWorker' in navigator){ const regs=await navigator.serviceWorker.getRegistrations(); await Promise.all(regs.map(r=>r.unregister())); }
      location.href=CANONICAL;
    });
    render();
    document.getElementById('ver').textContent='3.9.7a';
  });

  if('serviceWorker' in navigator){ window.addEventListener('load',()=>{ navigator.serviceWorker.register('./sw.js'); }); }
</script>
</body>
</html>
