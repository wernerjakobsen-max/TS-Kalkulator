<!doctype html>
<html lang="no" data-theme="auto">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title id="t_app">TS-kalkulator</title>
  <link rel="manifest" href="manifest.webmanifest">
  <meta name="theme-color" content="#00FFFF" id="themeColor">
  <link rel="icon" href="icon.svg" type="image/svg+xml">

  <style>
    :root {
      --bg: #f5f5f7;
      --bg-alt: #ffffff;
      --fg: #111827;
      --fg-muted: #4b5563;
      --accent: #00bcd4;
      --accent-soft: rgba(0, 188, 212, 0.1);
      --border: #e5e7eb;
      --shadow-soft: 0 10px 25px rgba(15, 23, 42, 0.08);
      --radius-lg: 1.25rem;
      --radius-md: 0.75rem;
      --radius-pill: 999px;
      --input-bg: #f9fafb;
      --input-border: #d1d5db;
      --danger: #ef4444;
    }

    [data-theme="dark"] {
      --bg: #020617;
      --bg-alt: #020617;
      --fg: #e5e7eb;
      --fg-muted: #9ca3af;
      --accent: #22d3ee;
      --accent-soft: rgba(34, 211, 238, 0.1);
      --border: #1f2933;
      --shadow-soft: 0 18px 40px rgba(0, 0, 0, 0.6);
      --input-bg: #020617;
      --input-border: #374151;
    }

    * {
      box-sizing: border-box;
    }

    html, body {
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, rgba(34, 211, 238, 0.16), transparent 60%), var(--bg);
      color: var(--fg);
    }

    body {
      min-height: 100vh;
      display: flex;
      justify-content: center;
      padding: 16px;
    }

    .app-shell {
      width: 100%;
      max-width: 960px;
      background: linear-gradient(145deg, rgba(15, 23, 42, 0.02), transparent 50%), var(--bg-alt);
      border-radius: 1.75rem;
      box-shadow: var(--shadow-soft);
      padding: 20px 18px 24px;
      display: flex;
      flex-direction: column;
      gap: 18px;
      border: 1px solid rgba(148, 163, 184, 0.35);
      backdrop-filter: blur(16px);
    }

    @media (min-width: 768px) {
      .app-shell {
        padding: 24px 28px 28px;
        gap: 22px;
      }
    }

    header {
      display: flex;
      flex-wrap: wrap;
      gap: 14px;
      align-items: center;
      justify-content: space-between;
    }

    .title-block {
      display: flex;
      flex-direction: column;
      gap: 4px;
      min-width: 0;
    }

    .app-title-row {
      display: flex;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
    }

    h1 {
      font-size: 1.5rem;
      margin: 0;
      letter-spacing: -0.03em;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .badge {
      font-size: 0.7rem;
      padding: 3px 9px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      text-transform: uppercase;
      letter-spacing: 0.08em;
      font-weight: 600;
      color: var(--fg-muted);
      background: rgba(15, 23, 42, 0.02);
    }

    .subtitle {
      font-size: 0.85rem;
      color: var(--fg-muted);
      max-width: 32rem;
    }

    .controls-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: center;
      justify-content: flex-end;
    }

    .control-group {
      display: flex;
      align-items: center;
      gap: 6px;
      background: radial-gradient(circle at top left, rgba(148, 163, 184, 0.35), transparent 52%);
      border-radius: 999px;
      padding: 4px 6px 4px 10px;
      border: 1px solid rgba(148, 163, 184, 0.55);
    }

    .control-label {
      font-size: 0.8rem;
      color: var(--fg-muted);
      white-space: nowrap;
    }

    select, input[type="number"] {
      border-radius: 999px;
      border: 1px solid var(--input-border);
      padding: 6px 10px;
      font-size: 0.85rem;
      background: var(--input-bg);
      color: var(--fg);
      outline: none;
      min-width: 70px;
    }

    select:focus, input[type="number"]:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px var(--accent-soft);
    }

    .theme-select {
      min-width: 90px;
    }

    main {
      display: flex;
      flex-direction: column;
      gap: 18px;
    }

    .card {
      background: radial-gradient(circle at top left, var(--accent-soft), transparent 55%), var(--bg-alt);
      border-radius: var(--radius-lg);
      border: 1px solid rgba(148, 163, 184, 0.6);
      padding: 16px 16px 18px;
      display: flex;
      flex-direction: column;
      gap: 16px;
      box-shadow: 0 8px 30px rgba(15, 23, 42, 0.12);
    }

    @media (min-width: 768px) {
      .card {
        padding: 18px 20px 20px;
      }
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      gap: 10px;
      flex-wrap: wrap;
    }

    .card-title {
      font-size: 1.1rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .card-title-pill {
      font-size: 0.75rem;
      padding: 2px 8px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      color: var(--fg-muted);
    }

    .card-description {
      font-size: 0.8rem;
      color: var(--fg-muted);
      max-width: 30rem;
    }

    .fall-layout {
      display: grid;
      grid-template-columns: minmax(0, 1.4fr) minmax(0, 1fr);
      gap: 14px;
    }

    @media (max-width: 768px) {
      .fall-layout {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .fall-column {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .fall-field {
      background: rgba(15, 23, 42, 0.02);
      border-radius: var(--radius-md);
      padding: 10px 10px 11px;
      border: 1px solid rgba(148, 163, 184, 0.55);
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .fall-field label {
      font-size: 0.85rem;
      font-weight: 600;
    }

    .fall-field small {
      font-size: 0.75rem;
      color: var(--fg-muted);
    }

    .mini-row {
      display: flex;
      gap: 6px;
      align-items: center;
    }

    .mini-row input[type="number"] {
      flex: 1;
      border-radius: 999px;
    }

    .mini-row select {
      flex: 0 0 80px;
    }

    .btn-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 4px;
    }

    .btn {
      border-radius: var(--radius-pill);
      border: 1px solid rgba(148, 163, 184, 0.7);
      background: rgba(15, 23, 42, 0.02);
      padding: 6px 11px;
      font-size: 0.8rem;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .btn-primary {
      border-color: transparent;
      background: linear-gradient(135deg, var(--accent), #38bdf8);
      color: #0f172a;
      font-weight: 600;
    }

    .btn:hover {
      filter: brightness(1.05);
    }

    .result-box {
      background: rgba(15, 23, 42, 0.03);
      border-radius: var(--radius-md);
      border: 1px dashed rgba(148, 163, 184, 0.9);
      padding: 10px 11px;
      font-size: 0.85rem;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .result-main {
      font-weight: 600;
    }

    .result-sub {
      font-size: 0.78rem;
      color: var(--fg-muted);
    }

    .footer-note {
      font-size: 0.75rem;
      color: var(--fg-muted);
      margin-top: 2px;
    }

    .danger {
      color: var(--danger);
    }

    .muted {
      color: var(--fg-muted);
    }
  </style>

  <script>
    // Tema-init før render
    (function () {
      try {
        var s = localStorage.getItem('ts_theme') || 'auto';
        document.documentElement.setAttribute('data-theme', s);
        var tc = document.getElementById('themeColor');
        var preferDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
        var isDark = (s === 'dark') || (s === 'auto' && preferDark);
        if (tc) tc.setAttribute('content', isDark ? '#020617' : '#00FFFF');
      } catch (e) {
        // ignorer
      }
    })();
  </script>
</head>
<body>
  <div class="app-shell">
    <header>
      <div class="title-block">
        <div class="app-title-row">
          <h1 id="appTitle">
            TS-kalkulator
            <span class="badge" id="appBadge">Proff verktøy</span>
          </h1>
        </div>
        <div class="subtitle" id="appSubtitle">
          Praktisk fallkalkulator for håndverkere, montører og kontrollmåling ute på byggeplass.
        </div>
      </div>

      <div class="controls-row">
        <div class="control-group">
          <span class="control-label" id="langLabel">Språk</span>
          <select id="langSelect">
            <option value="no">Norsk</option>
            <option value="en">English</option>
            <option value="sv">Svenska</option>
            <option value="da">Dansk</option>
            <option value="fi">Suomi</option>
            <option value="de">Deutsch</option>
            <option value="pl">Polski</option>
            <option value="uk">Українська</option>
            <option value="sr">Srpski</option>
            <option value="ar">العربية</option>
            <option value="es">Español</option>
          </select>
        </div>

        <div class="control-group">
          <span class="control-label" id="themeLabel">Tema</span>
          <select id="themeSelect" class="theme-select">
            <option value="auto">Auto</option>
            <option value="light">Lyst</option>
            <option value="dark">Mørkt</option>
          </select>
        </div>
      </div>
    </header>

    <main>
      <!-- FALLKALKULATOR -->
      <section class="card" id="fallCard">
        <div class="card-header">
          <div>
            <div class="card-title" id="fallTitle">
              Fallkalkulator
              <span class="card-title-pill" id="fallTitlePill">% – mm/m – høyde</span>
            </div>
            <div class="card-description" id="fallDescription">
              Regn ut fall i prosent, fallforhold og høydeforskjell. Velg enheter som passer jobben.
            </div>
          </div>
        </div>

        <div class="fall-layout">
          <!-- Kolonne 1: Høyde og lengde -->
          <div class="fall-column">
            <!-- Høydeforskjell / lengde med enhetsvelger -->
            <div class="fall-field">
              <label id="fallHLLabel">Høydeforskjell og horisontal lengde</label>
              <small id="fallHLHint">
                Skriv inn høydeforskjell og lengde. Enheten velger du selv.
              </small>
              <div class="mini-row">
                <input
                  id="fallHeightVal"
                  type="number"
                  step="0.1"
                  inputmode="decimal"
                  placeholder="Høyde"
                  onchange="fallFromHeightLength()"
                >
                <select id="fallHeightUnit" onchange="fallFromHeightLength()">
                  <option value="mm">mm</option>
                  <option value="cm">cm</option>
                  <option value="m">m</option>
                </select>
              </div>
              <div class="mini-row" style="margin-top:6px;">
                <input
                  id="fallLengthVal"
                  type="number"
                  step="0.01"
                  inputmode="decimal"
                  placeholder="Lengde"
                  onchange="fallFromHeightLength()"
                >
                <select id="fallLengthUnit" onchange="fallFromHeightLength()">
                  <option value="m">m</option>
                  <option value="cm">cm</option>
                  <option value="mm">mm</option>
                </select>
              </div>
              <div class="btn-row">
                <button class="btn btn-primary" type="button" onclick="fallFromHeightLength()">
                  <span id="fallFromHLBtnLabel">Beregn fall</span>
                </button>
                <button class="btn" type="button" onclick="clearHLInputs()">
                  <span id="fallClearHLBtnLabel">Nullstill</span>
                </button>
              </div>
            </div>

            <div class="result-box" id="fallHLResultBox">
              <div class="result-main" id="fallHLResultMain">
                Ingen beregning enda.
              </div>
              <div class="result-sub" id="fallHLResultSub">
                Fyll inn høydeforskjell og lengde, så får du % fall og fallforhold.
              </div>
            </div>

            <div class="footer-note" id="fallFooter">
              Merk: 0 % fall gir uendelig fallforhold (ingen høydeforskjell).
            </div>
          </div>

          <!-- Kolonne 2: Fall % og hjelp -->
          <div class="fall-column">
            <div class="fall-field">
              <label id="fallPctLabel">Fall i prosent</label>
              <small id="fallPctHint">
                Skriv inn fall i prosent og lengde, så får du høydeforskjell.
              </small>
              <div class="mini-row">
                <input
                  id="fallPctVal"
                  type="number"
                  step="0.01"
                  inputmode="decimal"
                  placeholder="Fall %"
                  onchange="fallFromPercent()"
                >
                <span class="muted">%</span>
              </div>
              <div class="mini-row" style="margin-top:6px;">
                <input
                  id="fallPctLengthVal"
                  type="number"
                  step="0.01"
                  inputmode="decimal"
                  placeholder="Lengde"
                  onchange="fallFromPercent()"
                >
                <select id="fallPctLengthUnit" onchange="fallFromPercent()">
                  <option value="m">m</option>
                  <option value="cm">cm</option>
                  <option value="mm">mm</option>
                </select>
              </div>
              <div class="btn-row">
                <button class="btn btn-primary" type="button" onclick="fallFromPercent()">
                  <span id="fallFromPctBtnLabel">Beregn høyde</span>
                </button>
                <button class="btn" type="button" onclick="clearPctInputs()">
                  <span id="fallClearPctBtnLabel">Nullstill</span>
                </button>
              </div>
            </div>

            <div class="result-box" id="fallPctResultBox">
              <div class="result-main" id="fallPctResultMain">
                Ingen beregning enda.
              </div>
              <div class="result-sub" id="fallPctResultSub">
                Fyll inn fall i prosent og lengde, så får du høydeforskjell og fallforhold.
              </div>
            </div>
          </div>
        </div>
      </section>
    </main>
  </div>

  <script>
    // ---- i18n-tekster ----
    const translations = {
      no: {
        app_title: "TS-kalkulator",
        app_badge: "Proff verktøy",
        app_subtitle: "Praktisk fallkalkulator for håndverkere, montører og kontrollmåling ute på byggeplass.",
        lang_label: "Språk",
        theme_label: "Tema",
        theme_light: "Lyst",
        theme_dark: "Mørkt",
        theme_auto: "Auto",

        fall_title: "Fallkalkulator",
        fall_pill: "% – mm/m – høyde",
        fall_desc: "Regn ut fall i prosent, fallforhold og høydeforskjell. Velg enheter som passer jobben.",
        fall_hl_label: "Høydeforskjell og horisontal lengde",
        fall_hl_hint: "Skriv inn høydeforskjell og lengde. Enheten velger du selv.",
        fall_footer: "Merk: 0 % fall gir uendelig fallforhold (ingen høydeforskjell).",
        fall_height_ph: "Høyde",
        fall_length_ph: "Lengde",
        fall_from_hl_btn: "Beregn fall",
        fall_clear_hl_btn: "Nullstill",
        fall_hl_result_empty_main: "Ingen beregning enda.",
        fall_hl_result_empty_sub: "Fyll inn høydeforskjell og lengde, så får du % fall og fallforhold.",
        fall_pct_label: "Fall i prosent",
        fall_pct_hint: "Skriv inn fall i prosent og lengde, så får du høydeforskjell.",
        fall_pct_ph: "Fall %",
        fall_pct_length_ph: "Lengde",
        fall_from_pct_btn: "Beregn høyde",
        fall_clear_pct_btn: "Nullstill",
        fall_pct_result_empty_main: "Ingen beregning enda.",
        fall_pct_result_empty_sub: "Fyll inn fall i prosent og lengde, så får du høydeforskjell og fallforhold.",
        fall_result_height: h => `Høydeforskjell: ${h} mm`,
        fall_result_pct: p => `Fall: ${p} %`,
        fall_result_ratio: r => `Fallforhold: 1 : ${r}`,
        fall_result_error_missing: "Fyll inn både høyde og lengde.",
        fall_result_error_zero_length: "Lengden kan ikke være 0.",
        fall_result_error_negative: "Verdier kan ikke være negative."
      },

      en: {
        app_title: "TS Calculator",
        app_badge: "Pro tool",
        app_subtitle: "Practical slope calculator for installers, builders and on-site measurements.",
        lang_label: "Language",
        theme_label: "Theme",
        theme_light: "Light",
        theme_dark: "Dark",
        theme_auto: "Auto",

        fall_title: "Slope calculator",
        fall_pill: "% – mm/m – height",
        fall_desc: "Calculate slope in percent, slope ratio and height difference. Choose units that fit your job.",
        fall_hl_label: "Height difference and horizontal length",
        fall_hl_hint: "Enter height difference and length. You can choose the unit for each field.",
        fall_footer: "Note: 0% slope gives an infinite slope ratio (no height difference).",
        fall_height_ph: "Height",
        fall_length_ph: "Length",
        fall_from_hl_btn: "Calculate slope",
        fall_clear_hl_btn: "Clear",
        fall_hl_result_empty_main: "No calculation yet.",
        fall_hl_result_empty_sub: "Enter height difference and length to get % slope and slope ratio.",
        fall_pct_label: "Slope in percent",
        fall_pct_hint: "Enter slope in percent and length to get height difference.",
        fall_pct_ph: "Slope %",
        fall_pct_length_ph: "Length",
        fall_from_pct_btn: "Calculate height",
        fall_clear_pct_btn: "Clear",
        fall_pct_result_empty_main: "No calculation yet.",
        fall_pct_result_empty_sub: "Enter slope in percent and length to get height difference and slope ratio.",
        fall_result_height: h => `Height difference: ${h} mm`,
        fall_result_pct: p => `Slope: ${p} %`,
        fall_result_ratio: r => `Slope ratio: 1 : ${r}`,
        fall_result_error_missing: "Fill in both height and length.",
        fall_result_error_zero_length: "Length cannot be 0.",
        fall_result_error_negative: "Values cannot be negative."
      },

      sv: {
        app_title: "TS-kalkylator",
        app_badge: "Proffsverktyg",
        app_subtitle: "Praktisk fallkalkylator för hantverkare, montörer och kontrollmätning på byggplats.",
        lang_label: "Språk",
        theme_label: "Tema",
        theme_light: "Ljust",
        theme_dark: "Mörkt",
        theme_auto: "Auto",

        fall_title: "Fallkalkylator",
        fall_pill: "% – mm/m – höjd",
        fall_desc: "Beräkna fall i procent, fallförhållande och höjdskillnad. Välj enheter som passar jobbet.",
        fall_hl_label: "Höjdskillnad och horisontell längd",
        fall_hl_hint: "Ange höjdskillnad och längd. Du väljer enhet själv för varje fält.",
        fall_footer: "Obs: 0 % fall ger ett oändligt fallförhållande (ingen höjdskillnad).",
        fall_height_ph: "Höjd",
        fall_length_ph: "Längd",
        fall_from_hl_btn: "Beräkna fall",
        fall_clear_hl_btn: "Nollställ",
        fall_hl_result_empty_main: "Ingen beräkning ännu.",
        fall_hl_result_empty_sub: "Fyll i höjdskillnad och längd för att få % fall och fallförhållande.",
        fall_pct_label: "Fall i procent",
        fall_pct_hint: "Ange fall i procent och längd för att få höjdskillnad.",
        fall_pct_ph: "Fall %",
        fall_pct_length_ph: "Längd",
        fall_from_pct_btn: "Beräkna höjd",
        fall_clear_pct_btn: "Nollställ",
        fall_pct_result_empty_main: "Ingen beräkning ännu.",
        fall_pct_result_empty_sub: "Fyll i fall i procent och längd för att få höjdskillnad och fallförhållande.",
        fall_result_height: h => `Höjdskillnad: ${h} mm`,
        fall_result_pct: p => `Fall: ${p} %`,
        fall_result_ratio: r => `Fallförhållande: 1 : ${r}`,
        fall_result_error_missing: "Fyll i både höjd och längd.",
        fall_result_error_zero_length: "Längden kan inte vara 0.",
        fall_result_error_negative: "Värden kan inte vara negativa."
      },

      da: {
        app_title: "TS-kalkulator",
        app_badge: "Proffsværktøj",
        app_subtitle: "Praktisk faldkalkulator til håndværkere, montører og kontrolmåling på byggepladsen.",
        lang_label: "Sprog",
        theme_label: "Tema",
        theme_light: "Lyst",
        theme_dark: "Mørkt",
        theme_auto: "Auto",

        fall_title: "Faldkalkulator",
        fall_pill: "% – mm/m – højde",
        fall_desc: "Beregn fald i procent, faldforhold og højdeforskel. Vælg enheder der passer til opgaven.",
        fall_hl_label: "Højdeforskel og horisontal længde",
        fall_hl_hint: "Indtast højdeforskel og længde. Du vælger selv enhed for hvert felt.",
        fall_footer: "Bemærk: 0 % fald giver et uendeligt faldforhold (ingen højdeforskel).",
        fall_height_ph: "Højde",
        fall_length_ph: "Længde",
        fall_from_hl_btn: "Beregn fald",
        fall_clear_hl_btn: "Nulstil",
        fall_hl_result_empty_main: "Ingen beregning endnu.",
        fall_hl_result_empty_sub: "Udfyld højdeforskel og længde for at få % fald og faldforhold.",
        fall_pct_label: "Fald i procent",
        fall_pct_hint: "Indtast fald i procent og længde for at få højdeforskel.",
        fall_pct_ph: "Fald %",
        fall_pct_length_ph: "Længde",
        fall_from_pct_btn: "Beregn højde",
        fall_clear_pct_btn: "Nulstil",
        fall_pct_result_empty_main: "Ingen beregning endnu.",
        fall_pct_result_empty_sub: "Udfyld fald i procent og længde for at få højdeforskel og faldforhold.",
        fall_result_height: h => `Højdeforskel: ${h} mm`,
        fall_result_pct: p => `Fald: ${p} %`,
        fall_result_ratio: r => `Faldforhold: 1 : ${r}`,
        fall_result_error_missing: "Udfyld både højde og længde.",
        fall_result_error_zero_length: "Længden kan ikke være 0.",
        fall_result_error_negative: "Værdier kan ikke være negative."
      },

      fi: {
        app_title: "TS-laskin",
        app_badge: "Ammattilaisille",
        app_subtitle: "Käytännöllinen kaltevuuslaskin asentajille, rakentajille ja mittauksiin työmaalla.",
        lang_label: "Kieli",
        theme_label: "Teema",
        theme_light: "Vaalea",
        theme_dark: "Tumma",
        theme_auto: "Auto",

        fall_title: "Kaltevuuslaskin",
        fall_pill: "% – mm/m – korkeus",
        fall_desc: "Laske kaltevuus prosentteina, suhdelukuna ja korkeuserona. Valitse työhön sopivat yksiköt.",
        fall_hl_label: "Korkeusero ja vaakasuora pituus",
        fall_hl_hint: "Syötä korkeusero ja pituus. Voit valita yksikön kumpaankin kenttään erikseen.",
        fall_footer: "Huom: 0 % kaltevuus antaa äärettömän suhteen (ei korkeuseroa).",
        fall_height_ph: "Korkeus",
        fall_length_ph: "Pituus",
        fall_from_hl_btn: "Laske kaltevuus",
        fall_clear_hl_btn: "Tyhjennä",
        fall_hl_result_empty_main: "Ei vielä laskentaa.",
        fall_hl_result_empty_sub: "Syötä korkeusero ja pituus, niin saat % kaltevuuden ja suhdeluvun.",
        fall_pct_label: "Kaltevuus prosentteina",
        fall_pct_hint: "Syötä kaltevuus prosentteina ja pituus, niin saat korkeuseron.",
        fall_pct_ph: "Kaltevuus %",
        fall_pct_length_ph: "Pituus",
        fall_from_pct_btn: "Laske korkeus",
        fall_clear_pct_btn: "Tyhjennä",
        fall_pct_result_empty_main: "Ei vielä laskentaa.",
        fall_pct_result_empty_sub: "Syötä kaltevuus prosentteina ja pituus, niin saat korkeuseron ja suhdeluvun.",
        fall_result_height: h => `Korkeusero: ${h} mm`,
        fall_result_pct: p => `Kaltevuus: ${p} %`,
        fall_result_ratio: r => `Suhdeluku: 1 : ${r}`,
        fall_result_error_missing: "Täytä sekä korkeus että pituus.",
        fall_result_error_zero_length: "Pituus ei voi olla 0.",
        fall_result_error_negative: "Arvot eivät voi olla negatiivisia."
      },

      de: {
        app_title: "TS-Rechner",
        app_badge: "Profi-Tool",
        app_subtitle: "Praktischer Gefällerechner für Handwerker, Monteure und Kontrollen auf der Baustelle.",
        lang_label: "Sprache",
        theme_label: "Thema",
        theme_light: "Hell",
        theme_dark: "Dunkel",
        theme_auto: "Auto",

        fall_title: "Gefällerechner",
        fall_pill: "% – mm/m – Höhe",
        fall_desc: "Berechnen Sie Gefälle in Prozent, Gefälleverhältnis und Höhenunterschied. Wählen Sie passende Einheiten.",
        fall_hl_label: "Höhenunterschied und horizontale Länge",
        fall_hl_hint: "Geben Sie Höhenunterschied und Länge ein. Sie können für jedes Feld die Einheit wählen.",
        fall_footer: "Hinweis: 0 % Gefälle ergibt ein unendliches Gefälleverhältnis (kein Höhenunterschied).",
        fall_height_ph: "Höhe",
        fall_length_ph: "Länge",
        fall_from_hl_btn: "Gefälle berechnen",
        fall_clear_hl_btn: "Zurücksetzen",
        fall_hl_result_empty_main: "Noch keine Berechnung.",
        fall_hl_result_empty_sub: "Geben Sie Höhenunterschied und Länge ein, um % Gefälle und Gefälleverhältnis zu erhalten.",
        fall_pct_label: "Gefälle in Prozent",
        fall_pct_hint: "Geben Sie Gefälle in Prozent und Länge ein, um den Höhenunterschied zu erhalten.",
        fall_pct_ph: "Gefälle %",
        fall_pct_length_ph: "Länge",
        fall_from_pct_btn: "Höhe berechnen",
        fall_clear_pct_btn: "Zurücksetzen",
        fall_pct_result_empty_main: "Noch keine Berechnung.",
        fall_pct_result_empty_sub: "Geben Sie Gefälle in Prozent und Länge ein, um Höhenunterschied und Gefälleverhältnis zu erhalten.",
        fall_result_height: h => `Höhenunterschied: ${h} mm`,
        fall_result_pct: p => `Gefälle: ${p} %`,
        fall_result_ratio: r => `Gefälleverhältnis: 1 : ${r}`,
        fall_result_error_missing: "Bitte sowohl Höhe als auch Länge ausfüllen.",
        fall_result_error_zero_length: "Die Länge darf nicht 0 sein.",
        fall_result_error_negative: "Werte dürfen nicht negativ sein."
      },

      pl: {
        app_title: "Kalkulator TS",
        app_badge: "Narzędzie pro",
        app_subtitle: "Praktyczny kalkulator spadku dla fachowców, monterów i kontroli na budowie.",
        lang_label: "Język",
        theme_label: "Motyw",
        theme_light: "Jasny",
        theme_dark: "Ciemny",
        theme_auto: "Auto",

        fall_title: "Kalkulator spadku",
        fall_pill: "% – mm/m – wysokość",
        fall_desc: "Oblicz spadek w procentach, stosunek spadku i różnicę wysokości. Wybierz jednostki odpowiednie do pracy.",
        fall_hl_label: "Różnica wysokości i długość pozioma",
        fall_hl_hint: "Wprowadź różnicę wysokości i długość. Jednostkę możesz wybrać osobno dla każdego pola.",
        fall_footer: "Uwaga: spadek 0% daje nieskończony stosunek spadku (brak różnicy wysokości).",
        fall_height_ph: "Wysokość",
        fall_length_ph: "Długość",
        fall_from_hl_btn: "Oblicz spadek",
        fall_clear_hl_btn: "Wyczyść",
        fall_hl_result_empty_main: "Brak obliczeń.",
        fall_hl_result_empty_sub: "Wprowadź różnicę wysokości i długość, aby otrzymać spadek % i stosunek spadku.",
        fall_pct_label: "Spadek w procentach",
        fall_pct_hint: "Wprowadź spadek w procentach i długość, aby otrzymać różnicę wysokości.",
        fall_pct_ph: "Spadek %",
        fall_pct_length_ph: "Długość",
        fall_from_pct_btn: "Oblicz wysokość",
        fall_clear_pct_btn: "Wyczyść",
        fall_pct_result_empty_main: "Brak obliczeń.",
        fall_pct_result_empty_sub: "Wprowadź spadek w procentach i długość, aby otrzymać różnicę wysokości i stosunek spadku.",
        fall_result_height: h => `Różnica wysokości: ${h} mm`,
        fall_result_pct: p => `Spadek: ${p} %`,
        fall_result_ratio: r => `Stosunek spadku: 1 : ${r}`,
        fall_result_error_missing: "Wypełnij zarówno wysokość, jak i długość.",
        fall_result_error_zero_length: "Długość nie może wynosić 0.",
        fall_result_error_negative: "Wartości nie mogą być ujemne."
      },

      uk: {
        app_title: "TS-калькулятор",
        app_badge: "Профі-інструмент",
        app_subtitle: "Практичний калькулятор ухилу для майстрів, монтажників та контролю на будівельному майданчику.",
        lang_label: "Мова",
        theme_label: "Тема",
        theme_light: "Світла",
        theme_dark: "Темна",
        theme_auto: "Авто",

        fall_title: "Калькулятор ухилу",
        fall_pill: "% – мм/м – висота",
        fall_desc: "Розрахунок ухилу у відсотках, співвідношення падіння та перепаду висоти. Оберіть зручні одиниці.",
        fall_hl_label: "Перепад висоти та горизонтальна довжина",
        fall_hl_hint: "Введіть перепад висоти та довжину. Одиницю вимірювання можна обрати для кожного поля.",
        fall_footer: "Примітка: ухил 0% дає нескінченне співвідношення падіння (немає перепаду висоти).",
        fall_height_ph: "Висота",
        fall_length_ph: "Довжина",
        fall_from_hl_btn: "Розрахувати ухил",
        fall_clear_hl_btn: "Очистити",
        fall_hl_result_empty_main: "Поки що немає розрахунку.",
        fall_hl_result_empty_sub: "Введіть перепад висоти та довжину, щоб отримати % ухилу та співвідношення падіння.",
        fall_pct_label: "Ухил у відсотках",
        fall_pct_hint: "Введіть ухил у відсотках і довжину, щоб отримати перепад висоти.",
        fall_pct_ph: "Ухил %",
        fall_pct_length_ph: "Довжина",
        fall_from_pct_btn: "Розрахувати висоту",
        fall_clear_pct_btn: "Очистити",
        fall_pct_result_empty_main: "Поки що немає розрахунку.",
        fall_pct_result_empty_sub: "Введіть ухил у відсотках і довжину, щоб отримати перепад висоти та співвідношення падіння.",
        fall_result_height: h => `Перепад висоти: ${h} мм`,
        fall_result_pct: p => `Ухил: ${p} %`,
        fall_result_ratio: r => `Співвідношення падіння: 1 : ${r}`,
        fall_result_error_missing: "Заповніть і висоту, і довжину.",
        fall_result_error_zero_length: "Довжина не може бути 0.",
        fall_result_error_negative: "Значення не можуть бути від’ємними."
      },

      sr: {
        app_title: "TS-kalkulator",
        app_badge: "Pro alat",
        app_subtitle: "Praktičan kalkulator pada za majstore, montere i kontrolna merenja na gradilištu.",
        lang_label: "Jezik",
        theme_label: "Tema",
        theme_light: "Svetla",
        theme_dark: "Tamna",
        theme_auto: "Auto",

        fall_title: "Kalkulator pada",
        fall_pill: "% – mm/m – visina",
        fall_desc: "Izračunajte pad u procentima, odnos pada i visinsku razliku. Birajte jedinice koje vam odgovaraju.",
        fall_hl_label: "Visinska razlika i horizontalna dužina",
        fall_hl_hint: "Unesite visinsku razliku i dužinu. Jedinicu možete izabrati za svako polje.",
        fall_footer: "Napomena: pad od 0% daje beskonačan odnos pada (nema visinske razlike).",
        fall_height_ph: "Visina",
        fall_length_ph: "Dužina",
        fall_from_hl_btn: "Izračunaj pad",
        fall_clear_hl_btn: "Poništi",
        fall_hl_result_empty_main: "Još nema izračuna.",
        fall_hl_result_empty_sub: "Unesite visinsku razliku i dužinu da biste dobili % pada i odnos pada.",
        fall_pct_label: "Pad u procentima",
        fall_pct_hint: "Unesite pad u procentima i dužinu da biste dobili visinsku razliku.",
        fall_pct_ph: "Pad %",
        fall_pct_length_ph: "Dužina",
        fall_from_pct_btn: "Izračunaj visinu",
        fall_clear_pct_btn: "Poništi",
        fall_pct_result_empty_main: "Još nema izračuna.",
        fall_pct_result_empty_sub: "Unesite pad u procentima i dužinu da biste dobili visinsku razliku i odnos pada.",
        fall_result_height: h => `Visinska razlika: ${h} mm`,
        fall_result_pct: p => `Pad: ${p} %`,
        fall_result_ratio: r => `Odnos pada: 1 : ${r}`,
        fall_result_error_missing: "Popunite i visinu i dužinu.",
        fall_result_error_zero_length: "Dužina ne može biti 0.",
        fall_result_error_negative: "Vrednosti ne mogu biti negativne."
      },

      ar: {
        app_title: "حاسبة TS",
        app_badge: "أداة للمحترفين",
        app_subtitle: "حاسبة ميل عملية للعمال والفنيين وقياسات الموقع في مشاريع البناء.",
        lang_label: "اللغة",
        theme_label: "السمة",
        theme_light: "فاتح",
        theme_dark: "داكن",
        theme_auto: "تلقائي",

        fall_title: "حاسبة الميل",
        fall_pill: "% – ملم/متر – ارتفاع",
        fall_desc: "احسب الميل بالنسبة المئوية، ونسبة الميل، وفارق الارتفاع. اختر الوحدات المناسبة للعمل.",
        fall_hl_label: "فرق الارتفاع والطول الأفقي",
        fall_hl_hint: "أدخل فرق الارتفاع والطول. يمكنك اختيار وحدة القياس لكل خانة على حدة.",
        fall_footer: "ملاحظة: ميل بنسبة 0٪ يعطي نسبة سقوط لا نهائية (لا يوجد فرق في الارتفاع).",
        fall_height_ph: "الارتفاع",
        fall_length_ph: "الطول",
        fall_from_hl_btn: "احسب الميل",
        fall_clear_hl_btn: "إعادة تعيين",
        fall_hl_result_empty_main: "لا توجد عملية حسابية بعد.",
        fall_hl_result_empty_sub: "أدخل فرق الارتفاع والطول للحصول على نسبة الميل بالمئة ونسبة السقوط.",
        fall_pct_label: "الميل بالنسبة المئوية",
        fall_pct_hint: "أدخل الميل بالنسبة المئوية والطول للحصول على فرق الارتفاع.",
        fall_pct_ph: "الميل %",
        fall_pct_length_ph: "الطول",
        fall_from_pct_btn: "احسب الارتفاع",
        fall_clear_pct_btn: "إعادة تعيين",
        fall_pct_result_empty_main: "لا توجد عملية حسابية بعد.",
        fall_pct_result_empty_sub: "أدخل الميل بالنسبة المئوية والطول للحصول على فرق الارتفاع ونسبة السقوط.",
        fall_result_height: h => `فرق الارتفاع: ${h} ملم`,
        fall_result_pct: p => `الميل: ${p} ٪`,
        fall_result_ratio: r => `نسبة السقوط: 1 : ${r}`,
        fall_result_error_missing: "يجب ملء كل من الارتفاع والطول.",
        fall_result_error_zero_length: "لا يمكن أن يكون الطول صفراً.",
        fall_result_error_negative: "لا يمكن أن تكون القيم سالبة."
      },

      es: {
        app_title: "Calculadora TS",
        app_badge: "Herramienta pro",
        app_subtitle: "Práctica calculadora de pendiente para instaladores, constructores y mediciones en obra.",
        lang_label: "Idioma",
        theme_label: "Tema",
        theme_light: "Claro",
        theme_dark: "Oscuro",
        theme_auto: "Auto",

        fall_title: "Calculadora de pendiente",
        fall_pill: "% – mm/m – altura",
        fall_desc: "Calcula la pendiente en porcentaje, la relación de pendiente y la diferencia de altura. Elige las unidades que encajen con tu trabajo.",
        fall_hl_label: "Diferencia de altura y longitud horizontal",
        fall_hl_hint: "Introduce la diferencia de altura y la longitud. Puedes elegir la unidad para cada campo.",
        fall_footer: "Nota: una pendiente del 0% da una relación de pendiente infinita (sin diferencia de altura).",
        fall_height_ph: "Altura",
        fall_length_ph: "Longitud",
        fall_from_hl_btn: "Calcular pendiente",
        fall_clear_hl_btn: "Borrar",
        fall_hl_result_empty_main: "Sin cálculos todavía.",
        fall_hl_result_empty_sub: "Introduce diferencia de altura y longitud para obtener la pendiente % y la relación de pendiente.",
        fall_pct_label: "Pendiente en porcentaje",
        fall_pct_hint: "Introduce la pendiente en porcentaje y la longitud para obtener la diferencia de altura.",
        fall_pct_ph: "Pendiente %",
        fall_pct_length_ph: "Longitud",
        fall_from_pct_btn: "Calcular altura",
        fall_clear_pct_btn: "Borrar",
        fall_pct_result_empty_main: "Sin cálculos todavía.",
        fall_pct_result_empty_sub: "Introduce la pendiente en porcentaje y la longitud para obtener la diferencia de altura y la relación de pendiente.",
        fall_result_height: h => `Diferencia de altura: ${h} mm`,
        fall_result_pct: p => `Pendiente: ${p} %`,
        fall_result_ratio: r => `Relación de pendiente: 1 : ${r}`,
        fall_result_error_missing: "Rellena tanto la altura como la longitud.",
        fall_result_error_zero_length: "La longitud no puede ser 0.",
        fall_result_error_negative: "Los valores no pueden ser negativos."
      }
    };

    let currentLang = 'no';

    function applyLanguage(lang) {
      const S = translations[lang] || translations.no;
      currentLang = lang;

      // Tittel + header
      document.getElementById('t_app').textContent = S.app_title;
      document.getElementById('appTitle').textContent = S.app_title;
      document.getElementById('appBadge').textContent = S.app_badge;
      document.getElementById('appSubtitle').textContent = S.app_subtitle;
      document.getElementById('langLabel').textContent = S.lang_label;
      document.getElementById('themeLabel').textContent = S.theme_label;

      // Tema-label i select (kun tekst i options ved init – vi lar verdiene være)
      const themeSelect = document.getElementById('themeSelect');
      if (themeSelect) {
        for (const opt of themeSelect.options) {
          if (opt.value === 'auto') opt.textContent = S.theme_auto;
          if (opt.value === 'light') opt.textContent = S.theme_light;
          if (opt.value === 'dark') opt.textContent = S.theme_dark;
        }
      }

      // Fall-kort
      document.getElementById('fallTitle').firstChild.textContent = S.fall_title + ' ';
      document.getElementById('fallTitlePill').textContent = S.fall_pill;
      document.getElementById('fallDescription').textContent = S.fall_desc;

      const fallHLLabel = document.getElementById('fallHLLabel');
      const fallHLHint = document.getElementById('fallHLHint');
      const fallFooter = document.getElementById('fallFooter');
      const fallHeightVal = document.getElementById('fallHeightVal');
      const fallLengthVal = document.getElementById('fallLengthVal');

      if (fallHLLabel) fallHLLabel.textContent = S.fall_hl_label || "Høydeforskjell og horisontal lengde";
      if (fallHLHint) fallHLHint.textContent = S.fall_hl_hint || "Skriv inn høydeforskjell og lengde. Enheten velger du selv.";
      if (fallFooter) fallFooter.textContent = S.fall_footer || "Merk: 0 % fall gir uendelig fallforhold (ingen høydeforskjell).";

      if (fallHeightVal) fallHeightVal.placeholder = S.fall_height_ph || "Høyde";
      if (fallLengthVal) fallLengthVal.placeholder = S.fall_length_ph || "Lengde";

      document.getElementById('fallFromHLBtnLabel').textContent = S.fall_from_hl_btn;
      document.getElementById('fallClearHLBtnLabel').textContent = S.fall_clear_hl_btn;

      // Tom-tekst for HL-resultat (hvis ingen beregning gjort)
      if (!document.getElementById('fallHLResultBox').dataset.hasResult) {
        document.getElementById('fallHLResultMain').textContent = S.fall_hl_result_empty_main;
        document.getElementById('fallHLResultSub').textContent = S.fall_hl_result_empty_sub;
      }

      // Prosent-del
      document.getElementById('fallPctLabel').textContent = S.fall_pct_label;
      document.getElementById('fallPctHint').textContent = S.fall_pct_hint;
      document.getElementById('fallPctVal').placeholder = S.fall_pct_ph;
      document.getElementById('fallPctLengthVal').placeholder = S.fall_pct_length_ph;
      document.getElementById('fallFromPctBtnLabel').textContent = S.fall_from_pct_btn;
      document.getElementById('fallClearPctBtnLabel').textContent = S.fall_clear_pct_btn;

      if (!document.getElementById('fallPctResultBox').dataset.hasResult) {
        document.getElementById('fallPctResultMain').textContent = S.fall_pct_result_empty_main;
        document.getElementById('fallPctResultSub').textContent = S.fall_pct_result_empty_sub;
      }
    }

    // ---- Tema ----
    function applyTheme(theme) {
      document.documentElement.setAttribute('data-theme', theme);
      try {
        localStorage.setItem('ts_theme', theme);
        const tc = document.getElementById('themeColor');
        const preferDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
        const isDark = (theme === 'dark') || (theme === 'auto' && preferDark);
        if (tc) tc.setAttribute('content', isDark ? '#020617' : '#00FFFF');
      } catch (e) {}
    }

    // ---- Fall-beregninger ----
    function unitToMeters(value, unit) {
      const v = parseFloat(value);
      if (isNaN(v)) return NaN;
      if (unit === 'mm') return v / 1000;
      if (unit === 'cm') return v / 100;
      return v; // m
    }

    function unitToMillimeters(value, unit) {
      const v = parseFloat(value);
      if (isNaN(v)) return NaN;
      if (unit === 'mm') return v;
      if (unit === 'cm') return v * 10;
      if (unit === 'm') return v * 1000;
      return v;
    }

    function fallFromHeightLength() {
      const lang = currentLang;
      const S = translations[lang] || translations.no;

      const hVal = document.getElementById('fallHeightVal').value;
      const hUnit = document.getElementById('fallHeightUnit').value;
      const lVal = document.getElementById('fallLengthVal').value;
      const lUnit = document.getElementById('fallLengthUnit').value;

      const resultMainEl = document.getElementById('fallHLResultMain');
      const resultSubEl = document.getElementById('fallHLResultSub');
      const box = document.getElementById('fallHLResultBox');

      const hMm = unitToMillimeters(hVal, hUnit);
      const lM = unitToMeters(lVal, lUnit);

      if (!hVal || !lVal) {
        resultMainEl.textContent = S.fall_result_error_missing;
        resultSubEl.textContent = "";
        box.dataset.hasResult = "1";
        resultMainEl.classList.add('danger');
        return;
      }

      if (lM === 0) {
        resultMainEl.textContent = S.fall_result_error_zero_length;
        resultSubEl.textContent = "";
        box.dataset.hasResult = "1";
        resultMainEl.classList.add('danger');
        return;
      }

      if (hMm < 0 || lM < 0) {
        resultMainEl.textContent = S.fall_result_error_negative;
        resultSubEl.textContent = "";
        box.dataset.hasResult = "1";
        resultMainEl.classList.add('danger');
        return;
      }

      resultMainEl.classList.remove('danger');

      const pct = (hMm / (lM * 1000)) * 100; // h(mm) / L(mm) * 100
      const ratio = (lM * 1000) / hMm; // L(mm) / h(mm)

      const pctRounded = Math.round(pct * 100) / 100;
      const ratioRounded = ratio === Infinity ? '∞' : Math.round(ratio * 10) / 10;

      const hText = S.fall_result_height(Math.round(hMm));
      const pText = S.fall_result_pct(pctRounded.toString().replace('.', ','));
      const rText = ratio === Infinity
        ? S.fall_result_ratio("∞")
        : S.fall_result_ratio(ratioRounded.toString().replace('.', ','));

      resultMainEl.textContent = `${pText}`;
      resultSubEl.textContent = `${hText} · ${rText}`;
      box.dataset.hasResult = "1";
    }

    function fallFromPercent() {
      const lang = currentLang;
      const S = translations[lang] || translations.no;

      const pVal = document.getElementById('fallPctVal').value;
      const lVal = document.getElementById('fallPctLengthVal').value;
      const lUnit = document.getElementById('fallPctLengthUnit').value;

      const resultMainEl = document.getElementById('fallPctResultMain');
      const resultSubEl = document.getElementById('fallPctResultSub');
      const box = document.getElementById('fallPctResultBox');

      if (!pVal || !lVal) {
        resultMainEl.textContent = S.fall_result_error_missing;
        resultSubEl.textContent = "";
        box.dataset.hasResult = "1";
        resultMainEl.classList.add('danger');
        return;
      }

      const p = parseFloat(pVal);
      const lM = unitToMeters(lVal, lUnit);

      if (lM === 0) {
        resultMainEl.textContent = S.fall_result_error_zero_length;
        resultSubEl.textContent = "";
        box.dataset.hasResult = "1";
        resultMainEl.classList.add('danger');
        return;
      }

      if (p < 0 || lM < 0) {
        resultMainEl.textContent = S.fall_result_error_negative;
        resultSubEl.textContent = "";
        box.dataset.hasResult = "1";
        resultMainEl.classList.add('danger');
        return;
      }

      resultMainEl.classList.remove('danger');

      // h = p% * L / 100  (L in mm)
      const hMm = (p / 100) * (lM * 1000);
      const ratio = (lM * 1000) / hMm;
      const hRounded = Math.round(hMm);
      const ratioRounded = ratio === Infinity ? '∞' : Math.round(ratio * 10) / 10;

      const hText = S.fall_result_height(hRounded);
      const pText = S.fall_result_pct(p.toString().replace('.', ','));
      const rText = ratio === Infinity
        ? S.fall_result_ratio("∞")
        : S.fall_result_ratio(ratioRounded.toString().replace('.', ','));

      resultMainEl.textContent = `${hText}`;
      resultSubEl.textContent = `${pText} · ${rText}`;
      box.dataset.hasResult = "1";
    }

    function clearHLInputs() {
      document.getElementById('fallHeightVal').value = '';
      document.getElementById('fallLengthVal').value = '';
      const box = document.getElementById('fallHLResultBox');
      box.dataset.hasResult = "";
      applyLanguage(currentLang);
    }

    function clearPctInputs() {
      document.getElementById('fallPctVal').value = '';
      document.getElementById('fallPctLengthVal').value = '';
      const box = document.getElementById('fallPctResultBox');
      box.dataset.hasResult = "";
      applyLanguage(currentLang);
    }

    // ---- Init ----
    window.addEventListener('DOMContentLoaded', () => {
      // Init språk fra localStorage
      const savedLang = (function () {
        try { return localStorage.getItem('ts_lang') || 'no'; } catch (e) { return 'no'; }
      })();

      const langSelect = document.getElementById('langSelect');
      if (langSelect) {
        langSelect.value = translations[savedLang] ? savedLang : 'no';
        langSelect.addEventListener('change', (e) => {
          const val = e.target.value;
          applyLanguage(val);
          try { localStorage.setItem('ts_lang', val); } catch (err) {}
        });
      }

      // Init tema fra localStorage
      const savedTheme = (function () {
        try { return localStorage.getItem('ts_theme') || 'auto'; } catch (e) { return 'auto'; }
      })();

      const themeSelect = document.getElementById('themeSelect');
      if (themeSelect) {
        themeSelect.value = savedTheme;
        themeSelect.addEventListener('change', (e) => {
          applyTheme(e.target.value);
        });
      }

      // Første gangs apply
      applyLanguage(savedLang);
      applyTheme(savedTheme);
    });
  </script>
</body>
</html>
