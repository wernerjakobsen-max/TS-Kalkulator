<!doctype html>
<html lang="no" data-theme="auto">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title id="t_app">TS-kalkulator</title>
  <link rel="manifest" href="manifest.webmanifest">
  <meta name="theme-color" content="#00FFFF" id="themeColor">
  <link rel="icon" href="icon.svg" type="image/svg+xml">
  <script>
    (function(){
      try{
        var s=localStorage.getItem('ts_theme')||'auto';
        document.documentElement.setAttribute('data-theme',s);
        var tc=document.getElementById('themeColor');
        var d=s==='dark'||(s==='auto'&&window.matchMedia&&window.matchMedia('(prefers-color-scheme: dark)').matches);
        if(tc)tc.setAttribute('content',d?'#0b1220':'#00FFFF');
      }catch(e){}
    })();
  </script>
  <style>
    :root{--bg:#f8fafc;--card:#fff;--muted:#475569;--text:#0f172a;--ring:#e2e8f0;--brand:#00FFFF;--brandText:#041b1b;}
    @media (prefers-color-scheme:dark){
      :root{--bg:#0b1220;--card:#0f172a;--muted:#9aa8bf;--text:#ebf0f7;--ring:#1f2937;--brand:#00FFFF;--brandText:#002c2c;}
    }
    [data-theme="dark"]{--bg:#0b1220;--card:#0f172a;--muted:#9aa8bf;--text:#ebf0f7;--ring:#1f2937;--brand:#00FFFF;--brandText:#002c2c;}
    [data-theme="light"]{--bg:#f8fafc;--card:#fff;--muted:#475569;--text:#0f172a;--ring:#e2e8f0;--brand:#00FFFF;--brandText:#041b1b;}
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,'Noto Sans',sans-serif}
    .wrap{max-width:820px;margin:0 auto;padding:14px 18px}
    .pill{display:inline-block;background:var(--brand);color:var(--brandText);padding:12px 22px;border-radius:16px;font-weight:800;border:1px solid #9efefe;box-shadow:0 1px 0 rgba(0,0,0,.06);font-size:28px}
    .subtitle{color:var(--muted);font-size:16px;margin:10px 0 10px}
    .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    .btn{display:inline-block;background:var(--brand);color:var(--brandText);text-decoration:none;padding:10px 14px;border-radius:12px;border:1px solid #9efefe;cursor:pointer}
    .ghost{background:transparent;border:1px solid var(--ring);color:var(--text)}
    .card{background:var(--card);border:1px solid var(--ring);border-radius:16px;padding:16px;box-shadow:0 2px 10px rgba(0,0,0,.04);margin-top:12px}
    label{display:block;font-size:13px;font-weight:700;margin-bottom:6px}
    input{width:100%;padding:12px 14px;border-radius:12px;border:1px solid var(--ring);font-size:20px;background:var(--card);color:var(--text)}
    input[type=range]{padding:0}
    .muted{color:var(--muted)}
    .big{font-size:48px;font-weight:900;letter-spacing:.5px}
    .footer{margin-top:18px;font-size:12px;display:flex;flex-wrap:wrap;gap:8px;align-items:center;justify-content:space-between;border-top:1px solid var(--ring);padding-top:8px}
    .small{font-size:11px;color:var(--muted);margin-top:6px;line-height:1.35}
    .svgbox{background:var(--bg);border:1px solid var(--ring);border-radius:12px;padding:8px;overflow:auto;margin-top:8px}
    .warn{color:#b91c1c}
    details.help>summary{cursor:pointer;font-weight:700}

    /* VerktÃ¸yvelger (TS / Fall) */
    .tool-switch {
      margin: 4px 0 10px;
      display: flex;
      gap: 8px;
      align-items: center;
      flex-wrap: wrap;
    }
    .tool-switch label {
      font-weight: 700;
      font-size: 14px;
    }
    .tool-switch select {
      padding: 6px 10px;
      border-radius: 10px;
      border: 1px solid var(--ring);
      background: var(--card);
      color: var(--text);
      font-size: 14px;
    }

    /* Fallkalkulator-layout */
    #tool-fall { margin-top: 8px; }
    #tool-fall h2 {
      margin: 0 0 6px;
      font-size: 20px;
    }
    .fall-info,
    .fall-footer {
      font-size: 13px;
      color: var(--muted);
    }
    .fall-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 10px;
      margin-top: 10px;
    }
    .fall-field {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }
    .fall-field label {
      font-weight: 700;
      font-size: 13px;
    }
    .fall-field small {
      font-size: 11px;
      color: var(--muted);
    }
    .mini-row {
      display:flex;
      gap:6px;
      align-items:center;
      flex-wrap:nowrap;
    }
    .mini-row input{
      flex:1 1 auto;
    }
    .mini-row select{
      flex:0 0 auto;
      padding:8px 10px;
      border-radius:10px;
      border:1px solid var(--ring);
      background:var(--card);
      color:var(--text);
      font-size:14px;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <!-- VerktÃ¸yvelger -->
    <div class="tool-switch">
      <label for="toolSelect">Velg kalkulator:</label>
      <select id="toolSelect" onchange="switchTool(this.value)">
        <option value="ts">TS-kalkulator</option>
        <option value="fall">Fallkalkulator</option>
      </select>
    </div>

    <!-- TS-kalkulator -->
    <div id="tool-ts">
      <div class="pill">TS-kalkulator</div>
      <div class="row" style="justify-content:space-between;align-items:flex-start">
        <div class="subtitle" id="h_sub">Avlest vinkel pÃ¥ tommestokk omregnet til grader</div>
        <div class="row" style="margin:6px 0 4px">
          <button class="btn" id="qrBtn">QR</button>
          <button class="btn" id="installBtn">Installer</button>
          <button class="btn ghost" id="themeBtn">ðŸŒ“</button>
          <button class="btn ghost" id="decBtn">0 des</button>
          <select id="lang" class="btn ghost" style="min-width:96px">
            <option value="no">NO</option><option value="en">EN</option><option value="sv">SV</option>
            <option value="dk">DK</option><option value="fi">FI</option><option value="de">DE</option>
          </select>
          <button class="btn ghost" id="hardRefreshBtn">Hard refresh</button>
        </div>
      </div>

      <section class="card">
        <label id="lbl_D">Avlest D (mm)</label>
        <input id="D" inputmode="decimal" value="760">
        <input id="sliderD" type="range" min="400" max="800" value="760" style="margin-top:12px">
        <div class="muted" id="rangeText" style="margin-top:6px">mÃ¥leomrÃ¥de 400-800mm</div>
        <div class="muted" style="margin-top:12px" id="lbl_angle">Vinkel (grader)</div>
        <div class="big" id="thetaTop">â€“</div>
      </section>

      <section class="card">
        <div class="subtitle" style="font-weight:800" id="guide_title">Bruksanvisning (kort)</div>
        <ul id="guide_list" class="muted"></ul>
        <details class="help" style="margin-top:8px">
          <summary id="help_btn">Vis forklaring og illustrasjon</summary>
          <div id="help_text" class="muted" style="margin:8px 0 6px"></div>
          <div class="svgbox">
            <!-- Technical SVG (horizontal base, 200 mm section points UP) -->
            <svg id="svgTech" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 940 360" width="100%">
              <defs>
                <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
                  <feDropShadow dx="0" dy="2" stdDeviation="2" flood-opacity="0.25"/>
                </filter>
                <marker id="arrow" viewBox="0 0 10 10" refX="9" refY="5" markerWidth="8" markerHeight="8" orient="auto-start-reverse">
                  <path d="M0 0L10 5L0 10Z" fill="#444"/>
                </marker>
              </defs>
              <!-- Base ruler -->
              <g transform="translate(60,200)">
                <rect x="0" y="-10" width="820" height="20" rx="4" fill="#e6e6e6" stroke="#888" filter="url(#shadow)"/>
                <g fill="#666">
                  <g>
                    <rect x="0" y="-10" width="2" height="10"/><text x="0" y="18" font-size="12" text-anchor="middle">0</text>
                    <rect x="100" y="-10" width="2" height="10"/><text x="100" y="18" font-size="12" text-anchor="middle">100</text>
                    <rect x="200" y="-10" width="2" height="10"/><text x="200" y="18" font-size="12" text-anchor="middle">200</text>
                    <rect x="300" y="-10" width="2" height="10"/><text x="300" y="18" font-size="12" text-anchor="middle">300</text>
                    <rect x="400" y="-10" width="2" height="10"/><text x="400" y="18" font-size="12" text-anchor="middle">400</text>
                    <rect x="500" y="-10" width="2" height="10"/><text x="500" y="18" font-size="12" text-anchor="middle">500</text>
                    <rect x="600" y="-10" width="2" height="10"/><text x="600" y="18" font-size="12" text-anchor="middle">600</text>
                    <rect x="700" y="-10" width="2" height="10"/><text x="700" y="18" font-size="12" text-anchor="middle">700</text>
                    <rect x="800" y="-10" width="2" height="10"/><text x="800" y="18" font-size="12" text-anchor="middle">800</text>
                  </g>
                  <g opacity="0.9">
                    <rect x="50" y="-10" width="1.6" height="8"/><rect x="150" y="-10" width="1.6" height="8"/>
                    <rect x="250" y="-10" width="1.6" height="8"/><rect x="350" y="-10" width="1.6" height="8"/>
                    <rect x="450" y="-10" width="1.6" height="8"/><rect x="550" y="-10" width="1.6" height="8"/>
                    <rect x="650" y="-10" width="1.6" height="8"/><rect x="750" y="-10" width="1.6" height="8"/>
                  </g>
                  <g opacity="0.6">
                    <rect x="10" y="-10" width="1.2" height="6"/><rect x="20" y="-10" width="1.2" height="6"/><rect x="30" y="-10" width="1.2" height="6"/><rect x="40" y="-10" width="1.2" height="6"/>
                    <rect x="60" y="-10" width="1.2" height="6"/><rect x="70" y="-10" width="1.2" height="6"/><rect x="80" y="-10" width="1.2" height="6"/><rect x="90" y="-10" width="1.2" height="6"/>
                    <rect x="110" y="-10" width="1.2" height="6"/><rect x="120" y="-10" width="1.2" height="6"/><rect x="130" y="-10" width="1.2" height="6"/><rect x="140" y="-10" width="1.2" height="6"/>
                    <rect x="160" y="-10" width="1.2" height="6"/><rect x="170" y="-10" width="1.2" height="6"/><rect x="180" y="-10" width="1.2" height="6"/><rect x="190" y="-10" width="1.2" height="6"/>
                    <rect x="210" y="-10" width="1.2" height="6"/><rect x="220" y="-10" width="1.2" height="6"/><rect x="230" y="-10" width="1.2" height="6"/><rect x="240" y="-10" width="1.2" height="6"/>
                    <rect x="260" y="-10" width="1.2" height="6"/><rect x="270" y="-10" width="1.2" height="6"/><rect x="280" y="-10" width="1.2" height="6"/><rect x="290" y="-10" width="1.2" height="6"/>
                    <rect x="310" y="-10" width="1.2" height="6"/><rect x="320" y="-10" width="1.2" height="6"/><rect x="330" y="-10" width="1.2" height="6"/><rect x="340" y="-10" width="1.2" height="6"/>
                    <rect x="360" y="-10" width="1.2" height="6"/><rect x="370" y="-10" width="1.2" height="6"/><rect x="380" y="-10" width="1.2" height="6"/><rect x="390" y="-10" width="1.2" height="6"/>
                    <rect x="410" y="-10" width="1.2" height="6"/><rect x="420" y="-10" width="1.2" height="6"/><rect x="430" y="-10" width="1.2" height="6"/><rect x="440" y="-10" width="1.2" height="6"/>
                    <rect x="460" y="-10" width="1.2" height="6"/><rect x="470" y="-10" width="1.2" height="6"/><rect x="480" y="-10" width="1.2" height="6"/><rect x="490" y="-10" width="1.2" height="6"/>
