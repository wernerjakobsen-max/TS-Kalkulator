<!doctype html>
<html lang="no" data-theme="auto">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title id="t_app">Vinkelkalkulator for tommestokk a-la Hultafors G59 | TS-kalkulator</title>
  <link rel="manifest" href="manifest.webmanifest">
  <meta name="theme-color" content="#00FFFF" id="themeColor">
  <link rel="icon" href="icon.svg" type="image/svg+xml">
  <meta name="description" content="Gratis vinkelkalkulator for tommestokk a-la Hultafors G59. Gir et praktisk estimat av vinkel basert pÃ¥ avlest millimeter. Et raskt og nyttig hjelpemiddel for bygg, snekkere og hÃ¥ndverkere. Inkluderer fallkalkulator og flersprÃ¥klig stÃ¸tte.">
  <script>
    (function(){
      try{
        var s=localStorage.getItem('ts_theme')||'auto';
        document.documentElement.setAttribute('data-theme',s);
        var tc=document.getElementById('themeColor');
        var d=s==='dark'||(s==='auto'&&window.matchMedia&&window.matchMedia('(prefers-color-scheme: dark)').matches);
        if(tc)tc.setAttribute('content',d?'#0b1220':'#00FFFF');
      }catch(e){}
    })();
  </script>
  <style>
    :root{--bg:#f8fafc;--card:#fff;--muted:#475569;--text:#0f172a;--ring:#e2e8f0;--brand:#00FFFF;--brandText:#041b1b;}
    @media (prefers-color-scheme:dark){
      :root{--bg:#0b1220;--card:#0f172a;--muted:#9aa8bf;--text:#ebf0f7;--ring:#1f2937;--brand:#00FFFF;--brandText:#002c2c;}
    }
    [data-theme="dark"]{--bg:#0b1220;--card:#0f172a;--muted:#9aa8bf;--text:#ebf0f7;--ring:#1f2937;--brand:#00FFFF;--brandText:#002c2c;}
    [data-theme="light"]{--bg:#f8fafc;--card:#fff;--muted:#475569;--text:#0f172a;--ring:#e2e8f0;--brand:#00FFFF;--brandText:#041b1b;}
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,'Noto Sans',sans-serif}
    .wrap{max-width:820px;margin:0 auto;padding:14px 18px}
    .pill{display:inline-flex;align-items:center;gap:8px;background:var(--brand);color:var(--brandText);padding:12px 22px;border-radius:16px;font-weight:800;border:1px solid #9efefe;box-shadow:0 1px 0 rgba(0,0,0,.06);font-size:28px}
    .pill-sm{font-size:16px;padding:8px 16px;border-radius:14px}
    .subtitle{color:var(--muted);font-size:16px;margin:10px 0 10px}
    .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    .btn{display:inline-block;background:var(--brand);color:var(--brandText);text-decoration:none;padding:10px 14px;border-radius:12px;border:1px solid #9efefe;cursor:pointer}
    .ghost{background:transparent;border:1px solid var(--ring);color:var(--text)}
    .card{background:var(--card);border:1px solid var(--ring);border-radius:16px;padding:16px;box-shadow:0 2px 10px rgba(0,0,0,.04);margin-top:12px}
    label{display:block;font-size:13px;font-weight:700;margin-bottom:6px}
    input{width:100%;padding:12px 14px;border-radius:12px;border:1px solid var(--ring);font-size:20px;background:var(--card);color:var(--text)}
    input[type=range]{padding:0}
    .muted{color:var(--muted)}
    .big{font-size:48px;font-weight:900;letter-spacing:.5px}
    .footer{margin-top:18px;font-size:12px;display:flex;flex-wrap:wrap;gap:8px;align-items:center;justify-content:space-between;border-top:1px solid var(--ring);padding-top:8px}
    .small{font-size:11px;color:var(--muted);margin-top:6px;line-height:1.35}
    .svgbox{background:var(--bg);border:1px solid var(--ring);border-radius:12px;padding:8px;overflow:auto;margin-top:8px}
    .warn{color:#b91c1c}

    /* VerktÃ¸yvelger (TS / Fall) */
    .tool-switch {
      margin: 4px 0 10px;
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      align-items:center;
      justify-content:space-between;
    }
    .tool-switch-inner{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      align-items:center;
    }
    .tool-switch select {
      padding:6px 10px;
      border-radius:10px;
      border:1px solid #9efefe;
      background:rgba(255,255,255,0.85);
      color:var(--brandText);
      font-size:14px;
    }

    /* Fallkalkulator-layout */
    #tool-fall { margin-top: 8px; }
    .fall-info,
    .fall-footer {
      font-size: 13px;
      color: var(--muted);
    }
    .fall-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 10px;
      margin-top: 10px;
    }
    .fall-field {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }
    .fall-field label {
      font-weight: 700;
      font-size: 13px;
    }
    .fall-field small {
      font-size: 11px;
      color: var(--muted);
    }
    .mini-row {
      display:flex;
      gap:6px;
      align-items:center;
      flex-wrap:nowrap;
    }
    .mini-row input{
      flex:1 1 auto;
    }
    .mini-row select{
      flex:0 0 auto;
      padding:8px 10px;
      border-radius:10px;
      border:1px solid var(--ring);
      background:var(--card);
      color:var(--text);
      font-size:14px;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <!-- VerktÃ¸yvelger + sprÃ¥kvelger i cyan pill -->
    <div class="tool-switch">
      <div class="pill pill-sm">
        <div class="tool-switch-inner">
          <span id="lbl_toolChoice">Velg kalkulator:</span>
          <select id="toolSelect" onchange="switchTool(this.value)">
            <option value="ts">TS-kalkulator</option>
            <option value="fall">Fallkalkulator</option>
          </select>
        </div>
      </div>
      <select id="lang" class="btn ghost" style="min-width:96px">
        <option value="no">NO</option>
        <option value="en">EN</option>
        <option value="sv">SV</option>
        <option value="dk">DK</option>
        <option value="fi">FI</option>
        <option value="de">DE</option>
        <option value="sr">SR</option>
        <option value="uk">UK</option>
        <option value="pl">PL</option>
        <option value="ar">AR</option>
      </select>
    </div>

    <!-- TS-kalkulator -->
    <div id="tool-ts">
      <div class="pill">TS-kalkulator</div>
      <div class="row" style="justify-content:space-between;align-items:flex-start">
        <div class="subtitle" id="h_sub">Avlest vinkel pÃ¥ tommestokk omregnet til grader</div>
        <div class="row" style="margin:6px 0 4px">
          <button class="btn" id="qrBtn">QR</button>
          <button class="btn" id="installBtn">Installer</button>
          <button class="btn ghost" id="themeBtn">ğŸŒ“</button>
          <button class="btn ghost" id="decBtn">0 des</button>
          <button class="btn ghost" id="hardRefreshBtn">Hard refresh</button>
        </div>
      </div>

      <section class="card">
        <label id="lbl_D">Avlest mm</label>
        <input id="D" inputmode="decimal" value="760">
        <input id="sliderD" type="range" min="420" max="800" value="760" style="margin-top:12px">
        <div class="muted" id="rangeText" style="margin-top:6px">mÃ¥leomrÃ¥de 420â€“800mm</div>
        <div class="muted" style="margin-top:12px" id="lbl_angle">Vinkel (grader)</div>
        <div class="big" id="thetaTop">â€“</div>
      </section>

      <section class="card">
        <div class="subtitle" style="font-weight:800" id="guide_title">Bruksanvisning</div>
        <ul id="guide_list" class="muted"></ul>

        <!-- Bilde i stedet for SVG-illustrasjon -->
        <div class="svgbox">
          <img src="tsfolded.jpg"
               alt="Tommestokk med to ledd bÃ¸yd opp der mÃ¥ling tas pÃ¥ skalaen"
               style="max-width:100%;height:auto;display:block;margin:0 auto;">
        </div>
      </section>

      <div class="footer muted">
        <div>Â© Stymparen</div>
        <div id="ver">4.2.1</div>
      </div>
      <div class="small">
        Denne kalkulatoren gir et praktisk estimat basert pÃ¥ manuelle mÃ¥linger med en Hultafors G59. Resultatet er veiledende og ikke 100 % nÃ¸yaktig. â€”
        HultaforsÂ® er et registrert varemerke tilhÃ¸rende Hultafors Group. Denne kalkulatoren er uavhengig og ikke tilknyttet, godkjent av eller sponset av Hultafors. â€”
        HultaforsÂ® is a registered trademark of Hultafors Group. This calculator is independent and not affiliated with, endorsed or sponsored by Hultafors.
      </div>
    </div>

    <!-- Fallkalkulator -->
    <div id="tool-fall" style="display:none;">
      <section class="card">
        <div class="pill" id="fallTitle">Fallkalkulator</div>
        <p class="fall-info" id="fallIntro" style="margin-top:8px;">
          Legg inn verdi i ett av feltene. Trykk Enter eller klikk utenfor feltet for Ã¥ oppdatere de andre.
        </p>

        <div class="fall-grid">
          <!-- Prosent -->
          <div class="fall-field">
            <label for="fallPercent" id="fallPercentLabel">Fall i prosent (%)</label>
            <small id="fallPercentHint">Eksempel: 2 betyr 2 % fall</small>
            <input id="fallPercent" type="number" step="0.001" inputmode="decimal" onchange="fallFromPercent()">
          </div>

          <!-- Grader -->
          <div class="fall-field">
            <label for="fallDegrees" id="fallDegreesLabel">Fall i grader (Â°)</label>
            <small id="fallDegreesHint">Eksempel: 1.145 â‰ˆ 2 % fall</small>
            <input id="fallDegrees" type="number" step="0.001" inputmode="decimal" onchange="fallFromDegrees()">
          </div>

          <!-- Forhold 1:X -->
          <div class="fall-field">
            <label for="fallRatio" id="fallRatioLabel">Fallforhold (1 : X)</label>
            <small id="fallRatioHint">Skriv X. Eksempel: 50 for 1:50</small>
            <input id="fallRatio" type="text" inputmode="decimal" onchange="fallFromRatio()">
          </div>

          <!-- HÃ¸ydeforskjell / lengde med enhetsvelger -->
          <div class="fall-field">
            <label id="fallHLLabel">HÃ¸ydeforskjell og lengde</label>
            <small id="fallHLHint">Bruk samme strekning. Velg enhet for begge.</small>
            <div class="mini-row">
              <input id="fallHeightVal" type="number" step="0.1" inputmode="decimal" placeholder="HÃ¸yde" onchange="fallFromHeightLength()">
              <select id="fallHeightUnit" onchange="fallFromHeightLength()">
                <option value="mm">mm</option>
                <option value="cm">cm</option>
                <option value="m">m</option>
              </select>
            </div>
            <div class="mini-row" style="margin-top:6px;">
              <input id="fallLengthVal" type="number" step="0.01" inputmode="decimal" placeholder="Lengde" onchange="fallFromHeightLength()">
              <select id="fallLengthUnit" onchange="fallFromHeightLength()">
                <option value="m">m</option>
                <option value="cm">cm</option>
                <option value="mm">mm</option>
              </select>
            </div>
          </div>
        </div>

        <p class="fall-footer" id="fallFooter">
          Merk: 0 % fall gir uendelig fallforhold (ingen hÃ¸ydeforskjell).
        </p>
      </section>
    </div>
  </div>

  <!-- QR modal -->
  <div id="qrModal" style="display:none;align-items:center;justify-content:center;position:fixed;inset:0;background:rgba(0,0,0,.55);z-index:9999">
    <div class="card" style="max-width:92vw">
      <div class="row" style="justify-content:space-between"><h3 style="margin:0">QR-kode</h3><button class="btn ghost" id="qrClose">Lukk</button></div>
      <div class="muted" style="border:1px solid var(--ring);border-radius:10px;padding:8px 10px;margin-top:6px" id="qrUrlBox">https://wernerjakobsen-max.github.io/TS-Kalkulator/?v=4.2.1</div>
      <img id="qrImg" alt="QR-kode" style="display:block;margin:12px auto;border:1px solid var(--ring);max-width:72vw;height:auto">
      <div class="row"><button class="btn" id="copyUrl">Kopier lenke</button><a id="qrDownload" class="btn" download="ts-kalkulator-qr.png">Last ned PNG</a></div>
    </div>
  </div>

  <!-- Install modal -->
  <div id="instModal" style="display:none;align-items:center;justify-content:center;position:fixed;inset:0;background:rgba(0,0,0,.55);z-index:9999">
    <div class="card" style="max-width:92vw">
      <div class="row" style="justify-content:space-between"><h3 style="margin:0">Installer app</h3><button class="btn ghost" id="instClose">Lukk</button></div>
      <div class="muted" style="margin-top:8px">
        Hvis install-knappen ikke dukker opp: <br>
        <b>Android/Chrome:</b> meny â‹® â†’ Â«Legg til pÃ¥ startsidenÂ».<br>
        <b>iOS (Safari):</b> delingsikonet â‹ â†’ Â«FÃ¸y til Hjem-skjermÂ».<br>
        <b>Desktop:</b> adresselinje Â«Installer appÂ»-ikon eller meny.
      </div>
    </div>
  </div>

<script>
  const $ = (id) => document.getElementById(id);
  const CANONICAL="https://wernerjakobsen-max.github.io/TS-Kalkulator/?v=4.2.1";

  /* Nye data for TS-kalkulator â€“ basert pÃ¥ kontrollmÃ¥linger */
  const X=[420,430,453,485,500,525,536,563,594,635,677.5,718,756,779,791,796,800];
  const Y=[  8, 11,17.5, 27, 31,38.5, 42,50.5, 60, 74,  90,107.5,128,145,158,166,180];

  const STR={
    no:{
      app:"TS-kalkulator",
      sub:"Avlest vinkel pÃ¥ tommestokk omregnet til grader",
      lblD:"Avlest mm",
      range:"mÃ¥leomrÃ¥de 420â€“800mm",
      angle:"Vinkel (grader)",
      guide_title:"Bruksanvisning",
      guide:[
        "Utstyr: plast tommestokk 2m med 15mm leddbredde (f.eks. Hultafors G59).",
        "Knekk fÃ¸rst 200mm-leddet til Ã¸nsket vinkel.",
        "Knekk deretter leddet ved 400mm-punktet til 0-hjÃ¸rnet treffer tommestokken langs kanten.",
        "Les av mm langs kanten og skriv de inn her â€“ du fÃ¥r vinkelen i 200-leddet.",
        "MÃ¥leomrÃ¥de: 420â€“800mm (420â‰ˆ8Â°, 800â‰ˆ180Â°)."
      ],
      toolChoice:"Velg kalkulator:",
      fall_title:"Fallkalkulator",
      fall_intro:"Legg inn verdi i ett av feltene. Trykk Enter eller klikk utenfor feltet for Ã¥ oppdatere de andre.",
      fall_percent_label:"Fall i prosent (%)",
      fall_percent_hint:"Eksempel: 2 betyr 2 % fall",
      fall_deg_label:"Fall i grader (Â°)",
      fall_deg_hint:"Eksempel: 1.145 â‰ˆ 2 % fall",
      fall_ratio_label:"Fallforhold (1 : X)",
      fall_ratio_hint:"Skriv X. Eksempel: 50 for 1:50",
      fall_hl_label:"HÃ¸ydeforskjell og lengde",
      fall_hl_hint:"Bruk samme strekning. Velg enhet for begge.",
      fall_footer:"Merk: 0 % fall gir uendelig fallforhold (ingen hÃ¸ydeforskjell).",
      fall_height_ph:"HÃ¸yde",
      fall_length_ph:"Lengde"
    },
    en:{
      app:"TS Calculator",
      sub:"Angle from folding ruler reading (mm â†’ degrees)",
      lblD:"Reading (mm)",
      range:"measuring range 420â€“800 mm",
      angle:"Angle (degrees)",
      guide_title:"Instructions",
      guide:[
        "Tool: 2 m plastic folding ruler with 15 mm joints (e.g., Hultafors G59).",
        "First bend the 200 mm section to the desired angle.",
        "Then bend the joint at the 400 mm point until the 0-corner meets the ruler edge.",
        "Read the mm value along the edge and enter it here â€“ you get the angle in the 200 mm section.",
        "Valid range: 420â€“800 mm (420â‰ˆ8Â°, 800â‰ˆ180Â°)."
      ],
      toolChoice:"Select calculator:",
      fall_title:"Slope calculator",
      fall_intro:"Enter a value in one field. Press Enter or click outside the field to update the others.",
      fall_percent_label:"Slope in percent (%)",
      fall_percent_hint:"Example: 2 means 2% slope",
      fall_deg_label:"Slope in degrees (Â°)",
      fall_deg_hint:"Example: 1.145 â‰ˆ 2% slope",
      fall_ratio_label:"Slope ratio (1 : X)",
      fall_ratio_hint:"Type X. Example: 50 for 1:50",
      fall_hl_label:"Height difference and length",
      fall_hl_hint:"Use the same run. Choose units for both.",
      fall_footer:"Note: 0% slope gives infinite slope ratio (no height difference).",
      fall_height_ph:"Height",
      fall_length_ph:"Length"
    },
    sv:{
      app:"TS-kalkylator",
      sub:"AvlÃ¤st vinkel pÃ¥ tumstock omrÃ¤knad till grader",
      lblD:"AvlÃ¤st mm",
      range:"mÃ¤tomrÃ¥de 420â€“800 mm",
      angle:"Vinkel (grader)",
      guide_title:"Bruksanvisning",
      guide:[
        "Utrustning: plasttumstock 2 m med 15 mm led-bredd (t.ex. Hultafors G59).",
        "Vik fÃ¶rst 200 mm-ledet till Ã¶nskad vinkel.",
        "Vik sedan leden vid 400 mm-punkten tills 0-hÃ¶rnet mÃ¶ter tumstocken lÃ¤ngs kanten.",
        "LÃ¤s av mm lÃ¤ngs kanten och skriv in dem hÃ¤r â€“ du fÃ¥r vinkeln i 200 mm-ledet.",
        "MÃ¤tomrÃ¥de: 420â€“800 mm (420â‰ˆ8Â°, 800â‰ˆ180Â°)."
      ],
      toolChoice:"VÃ¤lj kalkylator:",
      fall_title:"Fallkalkylator",
      fall_intro:"Ange ett vÃ¤rde i ett av fÃ¤lten. Tryck Enter eller klicka utanfÃ¶r fÃ¤ltet fÃ¶r att uppdatera de andra.",
      fall_percent_label:"Fall i procent (%)",
      fall_percent_hint:"Exempel: 2 betyder 2 % fall",
      fall_deg_label:"Fall i grader (Â°)",
      fall_deg_hint:"Exempel: 1,145 â‰ˆ 2 % fall",
      fall_ratio_label:"FallfÃ¶rhÃ¥llande (1 : X)",
      fall_ratio_hint:"Skriv X. Exempel: 50 fÃ¶r 1:50",
      fall_hl_label:"HÃ¶jdskillnad och lÃ¤ngd",
      fall_hl_hint:"AnvÃ¤nd samma strÃ¤cka. VÃ¤lj enhet fÃ¶r bÃ¥da.",
      fall_footer:"Obs: 0 % fall ger oÃ¤ndligt fallfÃ¶rhÃ¥llande (ingen hÃ¶jdskillnad).",
      fall_height_ph:"HÃ¶jd",
      fall_length_ph:"LÃ¤ngd"
    },
    dk:{
      app:"TS-kalkulator",
      sub:"AflÃ¦st vinkel pÃ¥ tommestok omregnet til grader",
      lblD:"AflÃ¦st mm",
      range:"mÃ¥leomrÃ¥de 420â€“800 mm",
      angle:"Vinkel (grader)",
      guide_title:"Brugsvejledning",
      guide:[
        "Udstyr: plasttommestok 2 m med 15 mm led-bredde (fx Hultafors G59).",
        "BÃ¸j fÃ¸rst 200 mm-leddet til Ã¸nsket vinkel.",
        "BÃ¸j derefter leddet ved 400 mm-punktet til 0-hjÃ¸rnet mÃ¸der tommestokken langs kanten.",
        "AflÃ¦s mm langs kanten og skriv dem ind her â€“ du fÃ¥r vinklen i 200 mm-leddet.",
        "Gyldigt omrÃ¥de: 420â€“800 mm (420â‰ˆ8Â°, 800â‰ˆ180Â°)."
      ],
      toolChoice:"VÃ¦lg lommeregner:",
      fall_title:"Fald-kalkulator",
      fall_intro:"Indtast en vÃ¦rdi i Ã©t felt. Tryk Enter eller klik udenfor feltet for at opdatere de andre.",
      fall_percent_label:"Fald i procent (%)",
      fall_percent_hint:"Eksempel: 2 betyder 2 % fald",
      fall_deg_label:"Fald i grader (Â°)",
      fall_deg_hint:"Eksempel: 1,145 â‰ˆ 2 % fald",
      fall_ratio_label:"Faldforhold (1 : X)",
      fall_ratio_hint:"Skriv X. F.eks. 50 for 1:50",
      fall_hl_label:"HÃ¸jdeforskel og lÃ¦ngde",
      fall_hl_hint:"Brug samme strÃ¦kning. VÃ¦lg enhed for begge.",
      fall_footer:"BemÃ¦rk: 0 % fald giver uendeligt faldforhold (ingen hÃ¸jdeforskel).",
      fall_height_ph:"HÃ¸jde",
      fall_length_ph:"LÃ¦ngde"
    },
    fi:{
      app:"TS-laskin",
      sub:"Taittomitan lukema muunnettuna asteiksi",
      lblD:"Luettu mm-arvo",
      range:"mittausalue 420â€“800 mm",
      angle:"Kulma (astetta)",
      guide_title:"KÃ¤yttÃ¶ohje",
      guide:[
        "VÃ¤line: 2 m muovinen taittomitta, nivelten leveys 15 mm (esim. Hultafors G59).",
        "Taivuta ensin 200 mm osa haluttuun kulmaan.",
        "Taivuta sitten 400 mm kohdan niveltÃ¤, kunnes 0-kulma osuu mittaan reunan kohdalla.",
        "Lue millimetrit reunaa pitkin ja syÃ¶tÃ¤ arvo tÃ¤hÃ¤n â€“ saat kulman 200 mm osassa.",
        "Mittausalue: 420â€“800 mm (420â‰ˆ8Â°, 800â‰ˆ180Â°)."
      ],
      toolChoice:"Valitse laskin:",
      fall_title:"Kaato-laskin",
      fall_intro:"SyÃ¶tÃ¤ arvo johonkin kenttÃ¤Ã¤n. Paina Enter tai klikkaa kentÃ¤n ulkopuolelle pÃ¤ivittÃ¤Ã¤ksesi muut.",
      fall_percent_label:"Kaato prosentteina (%)",
      fall_percent_hint:"Esim.: 2 tarkoittaa 2 % kaatoa",
      fall_deg_label:"Kaato asteina (Â°)",
      fall_deg_hint:"Esim.: 1,145 â‰ˆ 2 % kaato",
      fall_ratio_label:"Kaatosuhde (1 : X)",
      fall_ratio_hint:"Kirjoita X. Esim.: 50 vastaa 1:50",
      fall_hl_label:"Korkeusero ja pituus",
      fall_hl_hint:"KÃ¤ytÃ¤ samaa matkaa. Valitse yksikkÃ¶ molemmille.",
      fall_footer:"Huom: 0 % kaato antaa Ã¤Ã¤rettÃ¶mÃ¤n suhteen (ei korkeuseroa).",
      fall_height_ph:"Korkeus",
      fall_length_ph:"Pituus"
    },
    de:{
      app:"TS-Rechner",
      sub:"Abgelesener Winkel am GliedermaÃŸstab in Grad",
      lblD:"Ablesung (mm)",
      range:"Messbereich 420â€“800 mm",
      angle:"Winkel (Grad)",
      guide_title:"Bedienungsanleitung",
      guide:[
        "Werkzeug: 2-m-GliedermaÃŸstab aus Kunststoff mit 15 mm Gelenkbreite (z. B. Hultafors G59).",
        "Zuerst das 200-mm-Glied auf den gewÃ¼nschten Winkel biegen.",
        "Dann das Gelenk bei 400 mm so biegen, bis die 0-mm-Ecke den MaÃŸstab entlang der Kante berÃ¼hrt.",
        "In mm entlang der Kante ablesen und hier eingeben â€“ Sie erhalten den Winkel im 200-mm-Glied.",
        "GÃ¼ltiger Bereich: 420â€“800 mm (420â‰ˆ8Â°, 800â‰ˆ180Â°)."
      ],
      toolChoice:"Rechner wÃ¤hlen:",
      fall_title:"GefÃ¤lle-Rechner",
      fall_intro:"Geben Sie einen Wert in ein Feld ein. DrÃ¼cken Sie Enter oder klicken Sie auÃŸerhalb, um die anderen zu aktualisieren.",
      fall_percent_label:"GefÃ¤lle in Prozent (%)",
      fall_percent_hint:"Beispiel: 2 bedeutet 2 % GefÃ¤lle",
      fall_deg_label:"GefÃ¤lle in Grad (Â°)",
      fall_deg_hint:"Beispiel: 1,145 â‰ˆ 2 % GefÃ¤lle",
      fall_ratio_label:"GefÃ¤lle-VerhÃ¤ltnis (1 : X)",
      fall_ratio_hint:"X eingeben. Beispiel: 50 fÃ¼r 1:50",
      fall_hl_label:"HÃ¶henunterschied und LÃ¤nge",
      fall_hl_hint:"Gleiche Strecke verwenden. Einheit fÃ¼r beide wÃ¤hlen.",
      fall_footer:"Hinweis: 0 % GefÃ¤lle ergibt ein unendliches VerhÃ¤ltnis (kein HÃ¶henunterschied).",
      fall_height_ph:"HÃ¶he",
      fall_length_ph:"LÃ¤nge"
    },
    /* Serbisk (latin) */
    sr:{
      app:"TS kalkulator",
      sub:"OÄitani ugao na sklopivom metru preraÄunat u stepene",
      lblD:"OÄitano (mm)",
      range:"merni opseg 420â€“800 mm",
      angle:"Ugao (stepeni)",
      guide_title:"Uputstvo",
      guide:[
        "Alat: plastiÄni sklopivi metar 2 m sa Å¡arkama Å¡irine 15 mm (npr. Hultafors G59).",
        "Prvo savij 200 mm segment na Å¾eljeni ugao.",
        "Zatim savij zglob na 400 mm taÄki dok se nulta ivica ne nasloni na skalu duÅ¾ ivice.",
        "OÄitaj milimetre duÅ¾ ivice i unesi ih ovde â€“ dobijaÅ¡ ugao u 200 mm segmentu.",
        "VaÅ¾eÄ‡i opseg: 420â€“800 mm (420â‰ˆ8Â°, 800â‰ˆ180Â°)."
      ],
      toolChoice:"Izaberi kalkulator:",
      fall_title:"Kalkulator nagiba",
      fall_intro:"Unesi vrednost u jedno polje. Pritisni Enter ili klikni van polja da se ostala aÅ¾uriraju.",
      fall_percent_label:"Nagib u procentima (%)",
      fall_percent_hint:"Primer: 2 znaÄi 2 % nagiba",
      fall_deg_label:"Nagib u stepenima (Â°)",
      fall_deg_hint:"Primer: 1,145 â‰ˆ 2 % nagiba",
      fall_ratio_label:"Odnos nagiba (1 : X)",
      fall_ratio_hint:"UpiÅ¡i X. Primer: 50 za 1:50",
      fall_hl_label:"Visinska razlika i duÅ¾ina",
      fall_hl_hint:"Koristi istu duÅ¾inu. Izaberi jedinicu za oba.",
      fall_footer:"Napomena: 0 % nagiba daje beskonaÄan odnos (nema visinske razlike).",
      fall_height_ph:"Visina",
      fall_length_ph:"DuÅ¾ina"
    },
    /* Ukrainsk */
    uk:{
      app:"TS-ĞºĞ°Ğ»ÑŒĞºÑƒĞ»ÑÑ‚Ğ¾Ñ€",
      sub:"Ğ—Ñ‡Ğ¸Ñ‚Ğ°Ğ½Ğ¸Ğ¹ ĞºÑƒÑ‚ Ğ½Ğ° ÑĞºĞ»Ğ°Ğ´Ğ½Ğ¾Ğ¼Ñƒ Ğ¼ĞµÑ‚Ñ€Ñ–, Ğ¿ĞµÑ€ĞµĞ²ĞµĞ´ĞµĞ½Ğ¸Ğ¹ Ñƒ Ğ³Ñ€Ğ°Ğ´ÑƒÑĞ¸",
      lblD:"Ğ—Ñ‡Ğ¸Ñ‚Ğ°Ğ½Ğ¾ (Ğ¼Ğ¼)",
      range:"Ğ´Ñ–Ğ°Ğ¿Ğ°Ğ·Ğ¾Ğ½ Ğ²Ğ¸Ğ¼Ñ–Ñ€ÑĞ²Ğ°Ğ½Ğ½Ñ 420â€“800 Ğ¼Ğ¼",
      angle:"ĞšÑƒÑ‚ (Ğ³Ñ€Ğ°Ğ´ÑƒÑĞ¸)",
      guide_title:"Ğ†Ğ½ÑÑ‚Ñ€ÑƒĞºÑ†Ñ–Ñ",
      guide:[
        "Ğ†Ğ½ÑÑ‚Ñ€ÑƒĞ¼ĞµĞ½Ñ‚: Ğ¿Ğ»Ğ°ÑÑ‚Ğ¸ĞºĞ¾Ğ²Ğ¸Ğ¹ ÑĞºĞ»Ğ°Ğ´Ğ½Ğ¸Ğ¹ Ğ¼ĞµÑ‚Ñ€ 2 Ğ¼ Ğ· ÑˆĞ°Ñ€Ğ½Ñ–Ñ€Ğ°Ğ¼Ğ¸ 15 Ğ¼Ğ¼ (Ğ½Ğ°Ğ¿Ñ€Ğ¸ĞºĞ»Ğ°Ğ´, Hultafors G59).",
        "Ğ¡Ğ¿ĞµÑ€ÑˆÑƒ Ğ·Ñ–Ğ³Ğ½Ñ–Ñ‚ÑŒ 200-Ğ¼Ğ¼ ÑĞµĞºÑ†Ñ–Ñ Ğ´Ğ¾ Ğ¿Ğ¾Ñ‚Ñ€Ñ–Ğ±Ğ½Ğ¾Ğ³Ğ¾ ĞºÑƒÑ‚Ğ°.",
        "ĞŸĞ¾Ñ‚Ñ–Ğ¼ Ğ·Ñ–Ğ³Ğ½Ñ–Ñ‚ÑŒ ÑˆĞ°Ñ€Ğ½Ñ–Ñ€ Ñƒ Ñ‚Ğ¾Ñ‡Ñ†Ñ– 400 Ğ¼Ğ¼, Ğ´Ğ¾ĞºĞ¸ Ğ½ÑƒĞ»ÑŒĞ¾Ğ²Ğ¸Ğ¹ ĞºÑƒÑ‚ Ğ½Ğµ Ñ‚Ğ¾Ñ€ĞºĞ½ĞµÑ‚ÑŒÑÑ ÑˆĞºĞ°Ğ»Ğ¸ Ğ²Ğ·Ğ´Ğ¾Ğ²Ğ¶ ĞºÑ€Ğ°Ñ.",
        "Ğ—Ñ‡Ğ¸Ñ‚Ğ°Ğ¹Ñ‚Ğµ Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ½Ñ Ğ² Ğ¼Ñ–Ğ»Ñ–Ğ¼ĞµÑ‚Ñ€Ğ°Ñ… ÑƒĞ·Ğ´Ğ¾Ğ²Ğ¶ ĞºÑ€Ğ°Ñ Ğ¹ Ğ²Ğ²ĞµĞ´Ñ–Ñ‚ÑŒ Ğ¹Ğ¾Ğ³Ğ¾ Ñ‚ÑƒÑ‚ â€” Ğ¾Ñ‚Ñ€Ğ¸Ğ¼Ğ°Ñ”Ñ‚Ğµ ĞºÑƒÑ‚ Ğ½Ğ° 200-Ğ¼Ğ¼ ÑĞµĞºÑ†Ñ–Ñ—.",
        "Ğ Ğ¾Ğ±Ğ¾Ñ‡Ğ¸Ğ¹ Ğ´Ñ–Ğ°Ğ¿Ğ°Ğ·Ğ¾Ğ½: 420â€“800 Ğ¼Ğ¼ (420â‰ˆ8Â°, 800â‰ˆ180Â°)."
      ],
      toolChoice:"Ğ’Ğ¸Ğ±ĞµÑ€Ñ–Ñ‚ÑŒ ĞºĞ°Ğ»ÑŒĞºÑƒĞ»ÑÑ‚Ğ¾Ñ€:",
      fall_title:"ĞšĞ°Ğ»ÑŒĞºÑƒĞ»ÑÑ‚Ğ¾Ñ€ ÑƒÑ…Ğ¸Ğ»Ñƒ",
      fall_intro:"Ğ’Ğ²ĞµĞ´Ñ–Ñ‚ÑŒ Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ½Ñ Ğ² Ğ¾Ğ´Ğ½Ğµ Ğ¿Ğ¾Ğ»Ğµ. ĞĞ°Ñ‚Ğ¸ÑĞ½Ñ–Ñ‚ÑŒ Enter Ğ°Ğ±Ğ¾ ĞºĞ»Ğ°Ñ†Ğ½Ñ–Ñ‚ÑŒ Ğ¿Ğ¾Ğ·Ğ° Ğ¿Ğ¾Ğ»ĞµĞ¼, Ñ‰Ğ¾Ğ± Ğ¾Ğ½Ğ¾Ğ²Ğ¸Ñ‚Ğ¸ Ñ–Ğ½ÑˆÑ–.",
      fall_percent_label:"Ğ£Ñ…Ğ¸Ğ» Ñƒ Ğ²Ñ–Ğ´ÑĞ¾Ñ‚ĞºĞ°Ñ… (%)",
      fall_percent_hint:"ĞŸÑ€Ğ¸ĞºĞ»Ğ°Ğ´: 2 Ğ¾Ğ·Ğ½Ğ°Ñ‡Ğ°Ñ” 2 % ÑƒÑ…Ğ¸Ğ»Ñƒ",
      fall_deg_label:"Ğ£Ñ…Ğ¸Ğ» Ñƒ Ğ³Ñ€Ğ°Ğ´ÑƒÑĞ°Ñ… (Â°)",
      fall_deg_hint:"ĞŸÑ€Ğ¸ĞºĞ»Ğ°Ğ´: 1,145 â‰ˆ 2 % ÑƒÑ…Ğ¸Ğ»Ñƒ",
      fall_ratio_label:"Ğ¡Ğ¿Ñ–Ğ²Ğ²Ñ–Ğ´Ğ½Ğ¾ÑˆĞµĞ½Ğ½Ñ ÑƒÑ…Ğ¸Ğ»Ñƒ (1 : X)",
      fall_ratio_hint:"Ğ’Ğ²ĞµĞ´Ñ–Ñ‚ÑŒ X. ĞĞ°Ğ¿Ñ€Ğ¸ĞºĞ»Ğ°Ğ´: 50 Ğ´Ğ»Ñ 1:50",
      fall_hl_label:"ĞŸĞµÑ€ĞµĞ¿Ğ°Ğ´ Ğ²Ğ¸ÑĞ¾Ñ‚ Ñ– Ğ´Ğ¾Ğ²Ğ¶Ğ¸Ğ½Ğ°",
      fall_hl_hint:"Ğ’Ğ¸ĞºĞ¾Ñ€Ğ¸ÑÑ‚Ğ¾Ğ²ÑƒĞ¹Ñ‚Ğµ Ñ‚Ñƒ ÑĞ°Ğ¼Ñƒ Ğ´Ğ¾Ğ²Ğ¶Ğ¸Ğ½Ñƒ. ĞĞ±ĞµÑ€Ñ–Ñ‚ÑŒ Ğ¾Ğ´Ğ¸Ğ½Ğ¸Ñ†Ñ– Ğ´Ğ»Ñ Ğ¾Ğ±Ğ¾Ñ….",
      fall_footer:"ĞŸÑ€Ğ¸Ğ¼Ñ–Ñ‚ĞºĞ°: 0 % ÑƒÑ…Ğ¸Ğ»Ñƒ Ğ´Ğ°Ñ” Ğ½ĞµÑĞºÑ–Ğ½Ñ‡ĞµĞ½Ğ½Ğµ ÑĞ¿Ñ–Ğ²Ğ²Ñ–Ğ´Ğ½Ğ¾ÑˆĞµĞ½Ğ½Ñ (Ğ½ĞµĞ¼Ğ°Ñ” Ğ¿ĞµÑ€ĞµĞ¿Ğ°Ğ´Ñƒ Ğ²Ğ¸ÑĞ¾Ñ‚).",
      fall_height_ph:"ĞŸĞµÑ€ĞµĞ¿Ğ°Ğ´ Ğ²Ğ¸ÑĞ¾Ñ‚Ğ¸",
      fall_length_ph:"Ğ”Ğ¾Ğ²Ğ¶Ğ¸Ğ½Ğ°"
    },
    /* Polsk */
    pl:{
      app:"Kalkulator TS",
      sub:"Odczytany kÄ…t na miarce skÅ‚adanej przeliczony na stopnie",
      lblD:"Odczyt (mm)",
      range:"zakres pomiarowy 420â€“800 mm",
      angle:"KÄ…t (stopnie)",
      guide_title:"Instrukcja",
      guide:[
        "NarzÄ™dzie: plastikowy metr skÅ‚adany 2 m z zawiasami 15 mm (np. Hultafors G59).",
        "Najpierw zegnij odcinek 200 mm do Å¼Ä…danego kÄ…ta.",
        "NastÄ™pnie zegnij zawias w punkcie 400 mm, aÅ¼ naroÅ¼nik 0 trafi w krawÄ™dÅº miarki.",
        "Odczytaj milimetry wzdÅ‚uÅ¼ krawÄ™dzi i wpisz je tutaj â€“ otrzymasz kÄ…t na odcinku 200 mm.",
        "Zakres: 420â€“800 mm (420â‰ˆ8Â°, 800â‰ˆ180Â°)."
      ],
      toolChoice:"Wybierz kalkulator:",
      fall_title:"Kalkulator spadku",
      fall_intro:"Wpisz wartoÅ›Ä‡ w jednym polu. NaciÅ›nij Enter lub kliknij poza polem, aby zaktualizowaÄ‡ pozostaÅ‚e.",
      fall_percent_label:"Spadek w procentach (%)",
      fall_percent_hint:"PrzykÅ‚ad: 2 oznacza 2 % spadku",
      fall_deg_label:"Spadek w stopniach (Â°)",
      fall_deg_hint:"PrzykÅ‚ad: 1,145 â‰ˆ 2 % spadku",
      fall_ratio_label:"Stosunek spadku (1 : X)",
      fall_ratio_hint:"Wpisz X. PrzykÅ‚ad: 50 dla 1:50",
      fall_hl_label:"RÃ³Å¼nica wysokoÅ›ci i dÅ‚ugoÅ›Ä‡",
      fall_hl_hint:"UÅ¼ywaj tej samej dÅ‚ugoÅ›ci. Wybierz jednostkÄ™ dla obu.",
      fall_footer:"Uwaga: spadek 0 % daje nieskoÅ„czony stosunek (brak rÃ³Å¼nicy wysokoÅ›ci).",
      fall_height_ph:"RÃ³Å¼nica wysokoÅ›ci",
      fall_length_ph:"DÅ‚ugoÅ›Ä‡"
    },
    /* Arabisk â€“ tekst blir RTL, men layouten er fortsatt LTR */
    ar:{
      app:"Ø­Ø§Ø³Ø¨Ø© TS",
      sub:"Ø²Ø§ÙˆÙŠØ© Ø§Ù„Ù…ØªØ± Ø§Ù„Ù‚Ø§Ø¨Ù„ Ù„Ù„Ø·ÙŠ Ù…Ø­Ø³ÙˆØ¨Ø© Ø¨Ø§Ù„Ø¯Ø±Ø¬Ø§Øª",
      lblD:"Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© (Ù…Ù…)",
      range:"Ù†Ø·Ø§Ù‚ Ø§Ù„Ù‚ÙŠØ§Ø³ 420â€“800 Ù…Ù…",
      angle:"Ø§Ù„Ø²Ø§ÙˆÙŠØ© (Â°)",
      guide_title:"Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…",
      guide:[
        "Ø§Ù„Ø£Ø¯Ø§Ø©: Ù…ØªØ± Ù‚Ø§Ø¨Ù„ Ù„Ù„Ø·ÙŠ Ø¨Ø·ÙˆÙ„ 2 Ù… Ù…Ø¹ Ù…ÙØµÙ„Ø§Øª Ø¹Ø±Ø¶Ù‡Ø§ 15 Ù…Ù… (Ù…Ø«Ù„ Hultafors G59).",
        "Ø£ÙˆÙ„Ø§Ù‹ØŒ Ø«Ù†ÙÙ‘ÙŠ Ø§Ù„Ø¬Ø²Ø¡ Ø¨Ø·ÙˆÙ„ 200 Ù…Ù… Ø¥Ù„Ù‰ Ø§Ù„Ø²Ø§ÙˆÙŠØ© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©.",
        "Ø«Ù… Ø«Ù†ÙÙ‘ Ø§Ù„Ù…ÙØµÙ„ Ø¹Ù†Ø¯ Ù†Ù‚Ø·Ø© 400 Ù…Ù… Ø­ØªÙ‰ ØªÙ„Ø§Ù…Ø³ Ø²Ø§ÙˆÙŠØ© Ø§Ù„ØµÙØ± Ø­Ø§ÙØ© Ø§Ù„Ù…Ù‚ÙŠØ§Ø³.",
        "Ø§Ù‚Ø±Ø£ Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ù„ÙŠÙ…ØªØ±Ø§Øª Ø¹Ù„Ù‰ Ø§Ù„Ø­Ø§ÙØ© ÙˆØ£Ø¯Ø®Ù„Ù‡Ø§ Ù‡Ù†Ø§ Ù„ØªØ­ØµÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø²Ø§ÙˆÙŠØ© ÙÙŠ Ø¬Ø²Ø¡ 200 Ù…Ù….",
        "Ù†Ø·Ø§Ù‚ Ø§Ù„Ø¹Ù…Ù„: 420â€“800 Ù…Ù… (420â‰ˆ8Â°ØŒ 800â‰ˆ180Â°)."
      ],
      toolChoice:"Ø§Ø®ØªØ± Ø§Ù„Ø­Ø§Ø³Ø¨Ø©:",
      fall_title:"Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ù…ÙŠÙ„",
      fall_intro:"Ø£Ø¯Ø®Ù„ Ù‚ÙŠÙ…Ø© ÙÙŠ Ø£Ø­Ø¯ Ø§Ù„Ø­Ù‚ÙˆÙ„. Ø§Ø¶ØºØ· Enter Ø£Ùˆ Ø§Ù†Ù‚Ø± Ø®Ø§Ø±Ø¬ Ø§Ù„Ø­Ù‚Ù„ Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨Ù‚ÙŠØ©.",
      fall_percent_label:"Ø§Ù„Ù…ÙŠÙ„ Ø¨Ø§Ù„Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø¦ÙˆÙŠØ© (%)",
      fall_percent_hint:"Ù…Ø«Ø§Ù„: 2 ØªØ¹Ù†ÙŠ Ù…ÙŠÙ„ 2Ùª",
      fall_deg_label:"Ø§Ù„Ù…ÙŠÙ„ Ø¨Ø§Ù„Ø¯Ø±Ø¬Ø§Øª (Â°)",
      fall_deg_hint:"Ù…Ø«Ø§Ù„: 1.145 â‰ˆ Ù…ÙŠÙ„ 2Ùª",
      fall_ratio_label:"Ù†Ø³Ø¨Ø© Ø§Ù„Ù…ÙŠÙ„ (1 : X)",
      fall_ratio_hint:"Ø§ÙƒØªØ¨ X. Ù…Ø«Ø§Ù„: 50 Ù…Ù† Ø£Ø¬Ù„ 1:50",
      fall_hl_label:"ÙØ±Ù‚ Ø§Ù„Ø§Ø±ØªÙØ§Ø¹ ÙˆØ§Ù„Ø·ÙˆÙ„",
      fall_hl_hint:"Ø§Ø³ØªØ®Ø¯Ù… Ù†ÙØ³ Ø§Ù„Ù…Ø³Ø§ÙØ©. Ø§Ø®ØªØ± Ù†ÙØ³ ÙˆØ­Ø¯Ø© Ø§Ù„Ù‚ÙŠØ§Ø³ Ù„ÙƒÙ„ÙŠÙ‡Ù…Ø§.",
      fall_footer:"Ù…Ù„Ø§Ø­Ø¸Ø©: Ù…ÙŠÙ„ 0Ùª ÙŠØ¹Ø·ÙŠ Ù†Ø³Ø¨Ø© Ù„Ø§ Ù†Ù‡Ø§Ø¦ÙŠØ© (Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙØ±Ù‚ Ø§Ø±ØªÙØ§Ø¹).",
      fall_height_ph:"Ø§Ø±ØªÙØ§Ø¹",
      fall_length_ph:"Ø·ÙˆÙ„"
    }
  };

  function pchipSlopes(x,y){
    const n=x.length,h=new Array(n-1),d=new Array(n-1);
    for(let i=0;i<n-1;i++){h[i]=x[i+1]-x[i];d[i]=(y[i+1]-y[i])/h[i];}
    const m=new Array(n); m[0]=d[0]; m[n-1]=d[n-2];
    for(let i=1;i<n-1;i++){
      if(d[i-1]*d[i]<=0) m[i]=0;
      else {
        const w1=2*h[i]+h[i-1],w2=h[i]+2*h[i-1];
        m[i]=(w1+w2)/(w1/d[i-1]+w2/d[i]);
      }
    }
    for(let i=0;i<n-1;i++){
      if(d[i]===0){m[i]=0; m[i+1]=0;}
      else {
        const a=m[i]/d[i],b=m[i+1]/d[i],s=a*a+b*b;
        if(s>9){
          const t=3/Math.sqrt(s);
          m[i]=t*a*d[i]; m[i+1]=t*b*d[i];
        }
      }
    }
    return m;
  }

  const M=pchipSlopes(X,Y);

  function pchipEval(xq){
    const n=X.length;
    if(xq<X[0]||xq>X[n-1])return null;
    let i=0,j=n-1;
    while(j-i>1){
      const k=(i+j)>>1;
      if(X[k]<=xq)i=k; else j=k;
    }
    const h=X[i+1]-X[i],t=(xq-X[i])/h;
    const h00=(1+2*t)*(1-t)*(1-t),
          h10=t*(1-t)*(1-t),
          h01=t*t*(3-2*t),
          h11=t*t*(t-1);
    return h00*Y[i]+h10*h*M[i]+h01*Y[i+1]+h11*h*M[i+1];
  }

  const LANG_KEY='ts_lang', DEC_KEY='ts_dec';
  const themeEl=document.documentElement,themeKey='ts_theme',themeColorTag=document.getElementById('themeColor');

  function applyTheme(v){
    themeEl.setAttribute('data-theme',v);
    try{localStorage.setItem(themeKey,v);}catch(e){}
    if(themeColorTag)themeColorTag.setAttribute('content',(v==='dark')?'#0b1220':'#00FFFF');
  }
  function toggleTheme(){
    const cur=themeEl.getAttribute('data-theme')||'auto';
    applyTheme(cur==='dark'?'light':cur==='light'?'auto':'dark');
  }
  function setLang(c){
    try{localStorage.setItem(LANG_KEY,c);}catch(e){}
    applyLang(c);
  }
  function getLang(){
    try{return localStorage.getItem(LANG_KEY)||'no';}catch(e){return'no';}
  }
  function getDec(){
    try{return parseInt(localStorage.getItem(DEC_KEY)||'0',10);}catch(e){return 0;}
  }
  function setDec(n){
    try{localStorage.setItem(DEC_KEY,String(n));}catch(e){}
    updateDecBtn(); render();
  }
  function toggleDec(){setDec(getDec()===0?1:0);}
  function updateDecBtn(){
    const b=$('decBtn');
    if(b)b.textContent=(getDec()===0?'0 des':'1 des');
  }
  function Fdeg(v){
    const d=getDec();
    return (d===0?Math.round(v):v.toFixed(d))+'Â°';
  }

  function applyLang(c){
    const S=(STR[c]||STR.no);
    document.title = S.app || "TS-kalkulator";
    const h_sub=$('h_sub'),lbl_D=$('lbl_D'),rangeText=$('rangeText'),lbl_angle=$('lbl_angle'),
          guide_title=$('guide_title'),guide_list=$('guide_list'),
          toolChoice=$('lbl_toolChoice');

    if(h_sub)h_sub.textContent=S.sub;
    if(lbl_D)lbl_D.textContent=S.lblD;
    if(rangeText)rangeText.textContent=S.range;
    if(lbl_angle)lbl_angle.textContent=S.angle;
    if(guide_title)guide_title.textContent=S.guide_title;
    if(guide_list){
      guide_list.innerHTML='';
      (S.guide||[]).forEach(t=>{
        const li=document.createElement('li');
        li.textContent=t;
        guide_list.appendChild(li);
      });
    }
    if(toolChoice)toolChoice.textContent=S.toolChoice||"Velg kalkulator:";

    // Fallkalkulator-tekster
    const fallTitle=$('fallTitle'),
          fallIntro=$('fallIntro'),
          fallPercentLabel=$('fallPercentLabel'),
          fallPercentHint=$('fallPercentHint'),
          fallDegreesLabel=$('fallDegreesLabel'),
          fallDegreesHint=$('fallDegreesHint'),
          fallRatioLabel=$('fallRatioLabel'),
          fallRatioHint=$('fallRatioHint'),
          fallHLLabel=$('fallHLLabel'),
          fallHLHint=$('fallHLHint'),
          fallFooter=$('fallFooter'),
          fallHeightVal=$('fallHeightVal'),
          fallLengthVal=$('fallLengthVal');

    if(fallTitle)fallTitle.textContent=S.fall_title||"Fallkalkulator";
    if(fallIntro)fallIntro.textContent=S.fall_intro||"Legg inn verdi i ett av feltene. Trykk Enter eller klikk utenfor feltet for Ã¥ oppdatere de andre.";
    if(fallPercentLabel)fallPercentLabel.textContent=S.fall_percent_label||"Fall i prosent (%)";
    if(fallPercentHint)fallPercentHint.textContent=S.fall_percent_hint||"Eksempel: 2 betyr 2 % fall";
    if(fallDegreesLabel)fallDegreesLabel.textContent=S.fall_deg_label||"Fall i grader (Â°)";
    if(fallDegreesHint)fallDegreesHint.textContent=S.fall_deg_hint||"Eksempel: 1.145 â‰ˆ 2 % fall";
    if(fallRatioLabel)fallRatioLabel.textContent=S.fall_ratio_label||"Fallforhold (1 : X)";
    if(fallRatioHint)fallRatioHint.textContent=S.fall_ratio_hint||"Skriv X. Eksempel: 50 for 1:50";
    if(fallHLLabel)fallHLLabel.textContent=S.fall_hl_label||"HÃ¸ydeforskjell og lengde";
    if(fallHLHint)fallHLHint.textContent=S.fall_hl_hint||"Bruk samme strekning. Velg enhet for begge.";
    if(fallFooter)fallFooter.textContent=S.fall_footer||"Merk: 0 % fall gir uendelig fallforhold (ingen hÃ¸ydeforskjell).";

    // HÃ¸yde / lengde placeholders fÃ¸lger sprÃ¥k
    if(fallHeightVal)fallHeightVal.placeholder = S.fall_height_ph || "HÃ¸yde";
    if(fallLengthVal)fallLengthVal.placeholder = S.fall_length_ph || "Lengde";
  }

  function updateIllustration(deg){
    // SVG er fjernet og erstattet med bilde â€“ funksjonen beholdes for kompatibilitet, men gjÃ¸r ingenting.
    return;
  }

  function render(){
    const thetaTop=$('thetaTop'),rangeText=$('rangeText'),sliderD=$('sliderD'),inp=$('D');
    if(!thetaTop||!rangeText||!sliderD||!inp)return;
    const D=parseFloat(String(inp.value).replace(',','.'));
    const MIN=420, MAX=800;

    if(!Number.isFinite(D)){
      thetaTop.textContent='â€“';
      updateIllustration(NaN);
      return;
    }

    // Vis at verdien er utenfor omrÃ¥de ved Ã¥ slÃ¥ av vinkelen
    if(D<MIN || D>MAX){
      sliderD.value = String(Math.max(MIN,Math.min(MAX,D)));
      rangeText.classList.add('warn');
      thetaTop.textContent='â€“';
      updateIllustration(NaN);
      return;
    }

    sliderD.value=String(D);
    const deg=pchipEval(D);
    if(deg==null){
      rangeText.classList.add('warn');
      thetaTop.textContent='â€“';
      updateIllustration(NaN);
    }else{
      rangeText.classList.remove('warn');
      thetaTop.textContent=Fdeg(deg);
      updateIllustration(deg);
    }
  }

  function openQR(){
    const url=CANONICAL, enc=encodeURIComponent(url);
    const box=$('qrUrlBox'),img=$('qrImg'),a=$('qrDownload'),modal=$('qrModal');
    if(box)box.textContent=url;
    if(img){img.src=`https://api.qrserver.com/v1/create-qr-code/?size=512x512&margin=10&data=${enc}`;}
    if(a && img)a.href=img.src;
    if(modal)modal.style.display='flex';
  }
  function closeQR(){const m=$('qrModal'); if(m)m.style.display='none';}
  function copyUrl(){
    if(!navigator.clipboard)return;
    navigator.clipboard.writeText(CANONICAL).then(()=>{
      const b=$('copyUrl'); if(!b)return;
      b.textContent='Kopiert!'; setTimeout(()=>{b.textContent='Kopier lenke';},1200);
    }).catch(()=>{});
  }

  let deferredPrompt=null;
  window.addEventListener('beforeinstallprompt',(e)=>{e.preventDefault();deferredPrompt=e;});
  async function tryInstall(){
    if(deferredPrompt){await deferredPrompt.prompt();deferredPrompt=null;return;}
    const m=$('instModal'); if(m)m.style.display='flex';
  }

  /* VerktÃ¸yvelger: TS / Fall */
  function switchTool(tool){
    const ts=$('tool-ts'),fall=$('tool-fall');
    if(!ts||!fall)return;
    if(tool==='fall'){ts.style.display='none';fall.style.display='block';}
    else{ts.style.display='block';fall.style.display='none';}
  }

  /* Fallkalkulator â€“ hjelpefunksjoner */
  function fallParseInput(id){
    const el=$(id); if(!el)return NaN;
    let raw=el.value.trim(); if(!raw)return NaN;
    raw=raw.replace(",",".");
    return parseFloat(raw);
  }
  function fallSetNumber(id,value,decimals){
    const el=$(id); if(!el||!isFinite(value))return;
    el.value=value.toFixed(decimals);
  }
  function fallSetText(id,value){
    const el=$(id); if(!el)return;
    el.value=value;
  }

  function fallUpdateAll(stigning){
    if(!isFinite(stigning)||stigning<0)return;
    fallSetNumber("fallPercent",stigning*100,3);
    fallSetNumber("fallDegrees",Math.atan(stigning)*180/Math.PI,3);
    if(stigning===0){fallSetText("fallRatio","âˆ");}
    else{
      const ratio=1/stigning;
      fallSetText("fallRatio",ratio.toFixed(3).replace(/\.?0+$/,""));
    }
  }

  function fallFromPercent(){
    const p=fallParseInput("fallPercent"); if(isNaN(p))return;
    const s=p/100; fallUpdateAll(s);
  }
  function fallFromDegrees(){
    const d=fallParseInput("fallDegrees"); if(isNaN(d))return;
    const s=Math.tan(d*Math.PI/180); fallUpdateAll(s);
  }
  function fallFromRatio(){
    const el=$("fallRatio"); if(!el)return;
    let raw=el.value.trim(); if(!raw)return;
    if(raw.indexOf(":")>=0){const parts=raw.split(":"); raw=parts[1]||parts[0];}
    raw=raw.replace(",",".");
    const r=parseFloat(raw); if(!isFinite(r)||r<=0)return;
    const s=1/r; fallUpdateAll(s);
  }

  function unitToMeters(value,unit){
    if(!isFinite(value))return NaN;
    if(unit==="mm")return value/1000;
    if(unit==="cm")return value/100;
    if(unit==="m")return value;
    return NaN;
  }

  function fallFromHeightLength(){
    const hVal=fallParseInput("fallHeightVal");
    const LVal=fallParseInput("fallLengthVal");
    const hUnitEl=$("fallHeightUnit"),LUnitEl=$("fallLengthUnit");
    const hUnit=hUnitEl?hUnitEl.value:"mm";
    const LUnit=LUnitEl?LUnitEl.value:"m";
    if(isNaN(hVal)||isNaN(LVal))return;
    const hM=unitToMeters(hVal,hUnit);
    const LM=unitToMeters(LVal,LUnit);
    if(!isFinite(hM)||!isFinite(LM)||LM<=0)return;
    const s=hM/LM; fallUpdateAll(s);
  }

  document.addEventListener('DOMContentLoaded',()=>{
    const langSel=$('lang'); const cur=getLang();
    if(langSel)langSel.value=cur;
    applyLang(cur);
    if(langSel){langSel.addEventListener('change',(e)=>{setLang(e.target.value);});}
    updateDecBtn();

    const decBtn=$('decBtn'); if(decBtn)decBtn.addEventListener('click',toggleDec);
    const themeBtn=$('themeBtn'); if(themeBtn)themeBtn.addEventListener('click',toggleTheme);

    const Dinput=$('D'); if(Dinput)Dinput.addEventListener('input',render);
    const sliderD=$('sliderD'); if(sliderD)sliderD.addEventListener('input',e=>{Dinput.value=e.target.value;render();});

    const qrBtn=$('qrBtn'); if(qrBtn)qrBtn.addEventListener('click',openQR);
    const qrClose=$('qrClose'); if(qrClose)qrClose.addEventListener('click',closeQR);
    const copyBtn=$('copyUrl'); if(copyBtn)copyBtn.addEventListener('click',copyUrl);

    const instBtn=$('installBtn'); if(instBtn)instBtn.addEventListener('click',tryInstall);
    const instClose=$('instClose'); if(instClose)instClose.addEventListener('click',()=>{const m=$('instModal');if(m)m.style.display='none';});

    const hardBtn=$('hardRefreshBtn');
    if(hardBtn)hardBtn.addEventListener('click', async ()=>{
      try{
        if('caches' in window){
          const names=await caches.keys();
          await Promise.all(names.map(n=>caches.delete(n)));
        }
        if('serviceWorker' in navigator){
          const regs=await navigator.serviceWorker.getRegistrations();
          await Promise.all(regs.map(r=>r.unregister()));
        }
      }catch(e){}
      location.href=CANONICAL;
    });

    render();
    const ver=$('ver'); if(ver)ver.textContent='4.2.1';
  });

  if('serviceWorker' in navigator){
    window.addEventListener('load',()=>{navigator.serviceWorker.register('./sw.js');});
  }
</script>
</body>
</html>
